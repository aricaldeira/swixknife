{% set
    NOW_TRANSLATIONS = {
        'ar': 'ÿØŸÑŸàŸÇÿ™Ÿä',
        'bn': '‡¶è‡¶ñ‡¶®',
        'bz': 'Ag√≤ra',
        'ca': 'Ara',
        'cy': 'Yn Awr',
        'da': 'Nu',
        'de': 'Jetzt',
        'ee': 'N√º√ºd',
        'el': 'Œ§œéœÅŒ±',
        'en': 'Now',
        'en-Shaw': 'êëØêë¨',
        'eo': 'Nun',
        'es': 'Ahora',
        'fa': 'ÿ≠ÿßŸÑÿß',
        'fi': 'Nyt',
        'fr': 'Maintenant',
        'ga': 'Anois',
        'gl': 'Agora',
        'gn': 'KoÍûå√°gÃÉa',
        'haw': ' ªƒÄn≈ç',
        'he': '◊¢◊õ◊©◊ô◊ï',
        'hi': '‡§Ö‡§¨',
        'hu': 'Most',
        'id': 'Kini',
        'is': 'N√∫',
        'it': 'Adesso',
        'iu': '·í´·ìê·ìá',
        'ja': '‰ªä',
        'kea': 'Agora',
        'kn': '‡≤à‡≤ó',
        'ko': 'ÏßÄÍ∏à',
        'lat': 'Nunc',
        'lb': 'Elo',
        'mt': 'Issa',
        'nb': 'N√•',
        'nl': 'Nu',
        'nn': 'No',
        'pl': 'Teraz',
        'pt': 'Agora',
        'ro': 'Acum',
        'ru': '–°–µ–π—á–∞—Å',
        'sv': 'Nu',
        'sw': 'Sasa',
        'tr': '≈ûimdi',
        'uk': '–¢–µ–ø–µ—Ä',
        'vi': 'B√¢y gi·ªù',
        'yo': 'B√°y√¨√≠',
        'zh': 'ÁèæÂú®',
        'zh_CN': 'Áé∞Âú®',
    }
%}
{% set TITLE = NOW_TRANSLATIONS.get(locale.LANGUAGE_TAG, NOW_TRANSLATIONS.get(locale.LANG, 'Now')) %}
{% if locale.base == 10 %}
    {% if '!' in locale.format_token %}
        {% set time_separator = 'Û±π∑' %}
    {% else %}
        {% set time_separator = locale.TIME_SEPARATOR %}
    {% endif %}
    {# set time_separator = 'Û±π∑' #}
    {% set sezimal_separator = 'Û±πÆ' %}
{% else %}
    {% set time_separator = locale.TIME_SEPARATOR %}
{% endif %}
<!doctype html>
<html lang="{{ locale.LANGUAGE_TAG }}" dir="{{ 'rtl' if locale.RTL else 'ltr' }}">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
        <title id="title">{{ TITLE }}</title>
        <meta name="description" content="{{ TITLE }}" />
        <meta name="author" content="Ari Caldeira" />
        {% include 'sezimal_css.html' %}
        <link rel="manifest" href="https://sezimal.tauga.online/now/manifest.json?{{ date.format('%Y%m%d%H%M%S') }}" crossorigin="use-credentials" />
        <link rel="icon" type="image/svg+xml" href="https://sezimal.tauga.online/now/icon-64.svg?{{ date.format('%Y%m%d%H%M%S') }}" />
<style>
{% if locale.LANGUAGE_TAG == 'en-Shaw' %}
:root {
    font-family: 'Inter Alia', 'Noto Sans Shavian', 'Andika', 'Sezimal QP', 'Noto Sans Hebrew', 'Noto Sans Arabic UI', 'Noto Sans Devanagari UI', 'Noto Sans Bengali UI', 'Noto Sans Symbols', 'Noto Sans Symbols2', sans-serif !important;
    --font-family-sans-serif: 'Inter Alia', 'Noto Sans Shavian', 'Andika', 'Sezimal QP', 'Noto Sans Hebrew', 'Noto Sans Arabic UI', 'Noto Sans Devanagari UI', 'Noto Sans Bengali UI', 'Noto Sans Symbols', 'Noto Sans Symbols2', sans-serif;
}
{% endif %}
</style>
<style id="moon-style">
.moon-emoji {
    display: inline-block;
}
</style>
    </head>
    <body>
    {% include 'calendar_settings.html' %}
    <div id="selectors" style="position: absolute; width: 100%">
        <span id="open_settings" class="emoji" style="float: left; opacity: 0.5; text-align: left;" onclick="open_settings()">¬†‚ò∞¬†</span>

        <!-- Stopwatch selectors -->
        <span id="show_stopwath" class="emoji" style="float: left; opacity: 0.5; text-align: left;" onclick="show_stopwath()" hidden>¬†‚è±Ô∏è¬†</span>
        <span id="show_clock_stopwatch" class="emoji" style="float: right; opacity: 0.5; text-align: right;" onclick="show_clock()" hidden>¬†‚åö¬†</span>

        <!-- Timer selectors -->
        <span id="show_clock_timer" class="emoji" style="float: left; opacity: 0.5; text-align: right;" onclick="show_clock()" hidden>¬†‚åö¬†</span>
        <span id="show_timer" class="emoji" style="float: right; opacity: 0.5; text-align: right;" onclick="show_timer()" hidden>¬†‚è≥¬†</span>
    </div>
    <div id="now_view">
    {% include 'calendar_view_now.html' %}
    </div>
    <div style="display: none;">
        <audio id="audio">
            <source src="https://midia.tauga.online/audio/sezimal/hexagon.ogg" type="audio/ogg" preload="auto" />
            <source src="https://midia.tauga.online/audio/sezimal/hexagon.mp3" type="audio/mpeg" preload="auto" />
            <source src="https://midia.tauga.online/audio/sezimal/hexagon.wav" type="audio/wav" preload="auto" />
        </audio>
    </div>
    </body>
    <script src="/static/js/calendar_today_api.js"></script>
    <script src="/static/js/calendar_load.js"></script>
    <script>
        if ((navigator.userAgent.toUpperCase().indexOf('MOBILE') > 0) || (navigator.userAgent.toUpperCase().indexOf('ANDROID') > 0)) {
            document.querySelector("body").requestFullscreen();
        };
        {% if force_decimal %}
            localStorage.setItem('sezimal-calendar-base', '14');
            localStorage.setItem('sezimal-calendar-format-token', '9');
        {% elif force_dozenal %}
            localStorage.setItem('sezimal-calendar-base', '20');
            localStorage.setItem('sezimal-calendar-format-token', '‚Üã');
        {% endif %}

        calendar_load();

        var time_display = '';
        var iso_time_display = '';
        var todays_day = {{ date.gregorian_day }};

        async function auto_refresh_iso_display(){
            var date = new Date();
            var seconds = date.getTime();
            var show_local_time = ({{date.time._time_zone_offset.decimal}} * 50000 / 27) != (date.getTimezoneOffset() * -60 * 1000);

            seconds = (seconds + ({{date.time._time_zone_offset.decimal}} * 50000 / 27)) / 1000 / 86400;
            var seconds_hands = seconds;
            seconds = seconds - Math.floor(seconds);

            var sec = Math.floor(seconds * 60 * 60 * 24);

            var hours = Math.floor(sec / 60 / 60);
            sec = sec - (hours * 60 * 60);

            var minutes = Math.floor(sec / 60);
            sec = sec - (minutes * 60);
            sec = Math.floor(sec);

            minutes = minutes.toString().padStart(2, '0');
            sec = sec.toString().padStart(2, '0');

            var hours_24 = hours.toString().padStart(2, '0');

            {% if locale.HOUR_FORMAT == '12h' and getattr(locale, 'ORIGINAL_HOUR_FORMAT', '24h') == '12h' %}
                if (hours > 12) {
                    hours = hours - 12;
                    {% if locale.show_seconds %}
                        sec = sec + '‚ÄØ{{ locale.lower(locale.PM) }}';
                    {% else %}
                        minutes = minutes + '‚ÄØ{{ locale.lower(locale.PM) }}';
                    {% endif %}
                } else if (hours == 12) {
                    {% if locale.show_seconds %}
                        sec = sec + '‚ÄØ{{ locale.lower(locale.PM) }}';
                    {% else %}
                        minutes = minutes + '‚ÄØ{{ locale.lower(locale.PM) }}';
                    {% endif %}
                } else {
                    {% if locale.show_seconds %}
                        sec = sec + '‚ÄØ{{ locale.lower(locale.AM) }}';
                    {% else %}
                        minutes = minutes + '‚ÄØ{{ locale.lower(locale.AM) }}';
                    {% endif %}
                };
            {% endif %}

            hours = hours.toString().padStart(2, '0');

            {% if locale.RTL %}
                {% if locale.show_seconds %}
                    iso_time_display = '\u{2066}' + hours + '{{ locale.TIME_SEPARATOR }}' + minutes + '{{ locale.TIME_SEPARATOR }}' + sec + '\u{2069}';
                {% else %}
                    iso_time_display = '\u{2066}' + hours + '{{ locale.TIME_SEPARATOR }}' + minutes + '\u{2069}';
                {% endif %}
            {% else %}
                {% if locale.show_seconds %}
                    iso_time_display = hours + '{{ locale.TIME_SEPARATOR }}' + minutes + '{{ locale.TIME_SEPARATOR }}' + sec;
                {% else %}
                    iso_time_display = hours + '{{ locale.TIME_SEPARATOR }}' + minutes;
                {% endif %}
            {% endif %}

            if ((show_local_time) && ({{locale.base}} != 14)) {
                {% if locale.show_seconds %}
                    iso_time_display = iso_time_display + ' (' + date.toLocaleTimeString('{{ locale.LANGUAGE_TAG }}').toLowerCase() + ')';
                {% else %}
                    iso_time_display = iso_time_display + ' (' + date.toLocaleTimeString('{{ locale.LANGUAGE_TAG }}', {hour: '2-digit', minute:'2-digit'}).toLowerCase() + ')';
                {% endif %}
            };

            var time_passed = Math.floor(seconds * 60 * 24);

            {% if '/NT' in locale.DEFAULT_TIME_ZONE %}
                if (time_passed < 120) {
                    document.getElementById('natural_time_sunrise').hidden = false;
                    document.getElementById('natural_time_sun').hidden = true;
                    document.getElementById('natural_time_sunset').hidden = true;
                    document.getElementById('natural_time_stars').hidden = true;
                } else if (time_passed < 780) {
                    document.getElementById('natural_time_sunrise').hidden = true;
                    document.getElementById('natural_time_sun').hidden = false;
                    document.getElementById('natural_time_sunset').hidden = true;
                    document.getElementById('natural_time_stars').hidden = true;
                } else if (time_passed < 870) {
                    document.getElementById('natural_time_sunrise').hidden = true;
                    document.getElementById('natural_time_sun').hidden = true;
                    document.getElementById('natural_time_sunset').hidden = false;
                    document.getElementById('natural_time_stars').hidden = true;
                } else if (time_passed < 1410) {
                    document.getElementById('natural_time_sunrise').hidden = true;
                    document.getElementById('natural_time_sun').hidden = true;
                    document.getElementById('natural_time_sunset').hidden = true;
                    document.getElementById('natural_time_stars').hidden = false;
                } else {
                    document.getElementById('natural_time_sunrise').hidden = false;
                    document.getElementById('natural_time_sun').hidden = true;
                    document.getElementById('natural_time_sunset').hidden = true;
                    document.getElementById('natural_time_stars').hidden = true;
                };
            {% elif '/MT' in locale.DEFAULT_TIME_ZONE %}
                if (time_passed < 60) {
                    document.getElementById('natural_time_sunrise').hidden = false;
                    document.getElementById('natural_time_sun').hidden = true;
                    document.getElementById('natural_time_sunset').hidden = true;
                    document.getElementById('natural_time_stars').hidden = true;
                } else if (time_passed < 660) {
                    document.getElementById('natural_time_sunrise').hidden = true;
                    document.getElementById('natural_time_sun').hidden = false;
                    document.getElementById('natural_time_sunset').hidden = true;
                    document.getElementById('natural_time_stars').hidden = true;
                } else if (time_passed < 750) {
                    document.getElementById('natural_time_sunrise').hidden = true;
                    document.getElementById('natural_time_sun').hidden = true;
                    document.getElementById('natural_time_sunset').hidden = false;
                    document.getElementById('natural_time_stars').hidden = true;
                } else if (time_passed < 1290) {
                    document.getElementById('natural_time_sunrise').hidden = true;
                    document.getElementById('natural_time_sun').hidden = true;
                    document.getElementById('natural_time_sunset').hidden = true;
                    document.getElementById('natural_time_stars').hidden = false;
                } else {
                    document.getElementById('natural_time_sunrise').hidden = false;
                    document.getElementById('natural_time_sun').hidden = true;
                    document.getElementById('natural_time_sunset').hidden = true;
                    document.getElementById('natural_time_stars').hidden = true;
                };
            {% else %}
                if (time_passed < 240) {
                    document.getElementById('natural_time_sunrise').hidden = true;
                    document.getElementById('natural_time_sun').hidden = true;
                    document.getElementById('natural_time_sunset').hidden = true;
                    document.getElementById('natural_time_stars').hidden = false;
                } else if (time_passed < 360) {
                    document.getElementById('natural_time_sunrise').hidden = false;
                    document.getElementById('natural_time_sun').hidden = true;
                    document.getElementById('natural_time_sunset').hidden = true;
                    document.getElementById('natural_time_stars').hidden = true;
                } else if (time_passed < 960) {
                    document.getElementById('natural_time_sunrise').hidden = true;
                    document.getElementById('natural_time_sun').hidden = false;
                    document.getElementById('natural_time_sunset').hidden = true;
                    document.getElementById('natural_time_stars').hidden = true;
                } else if (time_passed < 1110) {
                    document.getElementById('natural_time_sunrise').hidden = true;
                    document.getElementById('natural_time_sun').hidden = true;
                    document.getElementById('natural_time_sunset').hidden = false;
                    document.getElementById('natural_time_stars').hidden = true;
                } else {
                    document.getElementById('natural_time_sunrise').hidden = true;
                    document.getElementById('natural_time_sun').hidden = true;
                    document.getElementById('natural_time_sunset').hidden = true;
                    document.getElementById('natural_time_stars').hidden = false;
                };
            {% endif %}

            var proportion = (100 - (time_passed / 1440 * 100));

            if (proportion <= 10) {
                proportion = proportion + 3;
            };

            document.getElementById('natural_time_passed').style = 'width: ' + proportion.toString() + '%;';

            {% if locale.DIGITS %}
                iso_time_display = iso_time_display.replaceAll('0', '{{ locale.DIGITS[0] }}');
                iso_time_display = iso_time_display.replaceAll('1', '{{ locale.DIGITS[1] }}');
                iso_time_display = iso_time_display.replaceAll('2', '{{ locale.DIGITS[2] }}');
                iso_time_display = iso_time_display.replaceAll('3', '{{ locale.DIGITS[3] }}');
                iso_time_display = iso_time_display.replaceAll('4', '{{ locale.DIGITS[4] }}');
                iso_time_display = iso_time_display.replaceAll('5', '{{ locale.DIGITS[5] }}');
                iso_time_display = iso_time_display.replaceAll('6', '{{ locale.DIGITS[6] }}');
                iso_time_display = iso_time_display.replaceAll('7', '{{ locale.DIGITS[7] }}');
                iso_time_display = iso_time_display.replaceAll('8', '{{ locale.DIGITS[8] }}');
                iso_time_display = iso_time_display.replaceAll('9', '{{ locale.DIGITS[9] }}');
            {% endif %}

            {% if base == 14 %}
                if (document.getElementById('time_display')) {
                    document.getElementById('time_display').innerHTML = iso_time_display;
                };
            {% else %}
                if (document.getElementById('iso_time_display')) {
                    document.getElementById('iso_time_display').innerHTML = iso_time_display;
                };
            {% endif %}

            {% if locale.base == 14 %}
                seconds = seconds_hands;

                {% if locale.HOUR_FORMAT == '12h' %}
                var uta_angle = (seconds * 2 * 360);
                {% else %}
                var uta_angle = (seconds * 360);
                {% endif %}
                var posha_angle = ((seconds * 24) - Math.trunc(seconds * 24)) * 360;
                var agrima_angle = ((seconds * 24 * 60) - Math.trunc(seconds * 24 * 60)) * 360;
                document.getElementById('hand_uta').setAttribute('transform', `rotate(${uta_angle})`);
                document.getElementById('hand_posha').setAttribute('transform', `rotate(${posha_angle})`);
                document.getElementById('hand_agrima').setAttribute('transform', `rotate(${agrima_angle})`);
            {% endif %}

            //
            // Update every ten milliseconds
            //
            setTimeout(auto_refresh_iso_display, 10);

            if ((hours_24 === '00') && (date.getDay() != todays_day)) {
                todays_day = date.getDay();
                location.reload(true);
            };
        };
        auto_refresh_iso_display();

        async function auto_refresh_weather(){
            update_weather();
            //
            // Update every 13 poshas / 10 minutes
            //
            setTimeout(auto_refresh_weather, 10 * 60 * 1000);
        };
        auto_refresh_weather();

        {% if base == 10 or base == 100 %}
            async function auto_refresh_sezimal_time(){
                var seconds = new Date().getTime();

                seconds = (seconds + ({{date.time._time_zone_offset.decimal}}  * 50000 / 27)) / 1000 / 86400;
                seconds = seconds - Math.floor(seconds);

                {% if '!' in format_token %}
                    const PAIRS = {
                        '00': 'Û±∏ÄÛ±∏Ä', '01': 'Û±∏ÄÛ±∏Å', '02': 'Û±∏ÄÛ±∏Ç', '03': 'Û±∏ÄÛ±∏É', '04': 'Û±∏ÄÛ±∏Ñ', '05': 'Û±∏ÄÛ±∏Ö',
                        '10': 'Û±∏ÅÛ±∏Ä', '11': 'Û±∏ÅÛ±∏Å', '12': 'Û±∏ÅÛ±∏Ç', '13': 'Û±∏ÅÛ±∏É', '14': 'Û±∏ÅÛ±∏Ñ', '15': 'Û±∏ÅÛ±∏Ö',
                        '20': 'Û±∏ÇÛ±∏Ä', '21': 'Û±∏ÇÛ±∏Å', '22': 'Û±∏ÇÛ±∏Ç', '23': 'Û±∏ÇÛ±∏É', '24': 'Û±∏ÇÛ±∏Ñ', '25': 'Û±∏ÇÛ±∏Ö',
                        '30': 'Û±∏ÉÛ±∏Ä', '31': 'Û±∏ÉÛ±∏Å', '32': 'Û±∏ÉÛ±∏Ç', '33': 'Û±∏ÉÛ±∏É', '34': 'Û±∏ÉÛ±∏Ñ', '35': 'Û±∏ÉÛ±∏Ö',
                        '40': 'Û±∏ÑÛ±∏Ä', '41': 'Û±∏ÑÛ±∏Å', '42': 'Û±∏ÑÛ±∏Ç', '43': 'Û±∏ÑÛ±∏É', '44': 'Û±∏ÑÛ±∏Ñ', '45': 'Û±∏ÑÛ±∏Ö',
                        '50': 'Û±∏ÖÛ±∏Ä', '51': 'Û±∏ÖÛ±∏Å', '52': 'Û±∏ÖÛ±∏Ç', '53': 'Û±∏ÖÛ±∏É', '54': 'Û±∏ÖÛ±∏Ñ', '55': 'Û±∏ÖÛ±∏Ö',
                    };
                {% elif format_token == '@' %}
                    const PAIRS = {
                        '00': '0', '01': '1', '02': '2', '03': '3', '04': '4', '05': '5',
                        '10': '0Ãá', '11': '1Ãá', '12': '2Ãá', '13': '3Ãá', '14': '4Ãá', '15': '5Ãá',
                        '20': '0Ãà', '21': '1Ãà', '22': '2Ãà', '23': '3Ãà', '24': '4Ãà', '25': '5Ãà',
                        '30': '0Ãä', '31': '1Ãä', '32': '2Ãä', '33': '3Ãä', '34': '4Ãä', '35': '5Ãä',
                        '40': '0ÃÑ', '41': '1ÃÑ', '42': '2ÃÑ', '43': '3ÃÑ', '44': '4ÃÑ', '45': '5ÃÑ',
                        '50': '0ÃÜ', '51': '1ÃÜ', '52': '2ÃÜ', '53': '3ÃÜ', '54': '4ÃÜ', '55': '5ÃÜ',
                    };
                {% elif format_token == '@!' %}
                    const PAIRS = {
                        '00': 'Û±∏Ä', '01': 'Û±∏Å', '02': 'Û±∏Ç', '03': 'Û±∏É', '04': 'Û±∏Ñ', '05': 'Û±∏Ö',
                        '10': 'Û±∏Ü', '11': 'Û±∏á', '12': 'Û±∏à', '13': 'Û±∏â', '14': 'Û±∏ä', '15': 'Û±∏ã',
                        '20': 'Û±∏å', '21': 'Û±∏ç', '22': 'Û±∏é', '23': 'Û±∏è', '24': 'Û±∏ê', '25': 'Û±∏ë',
                        '30': 'Û±∏í', '31': 'Û±∏ì', '32': 'Û±∏î', '33': 'Û±∏ï', '34': 'Û±∏ñ', '35': 'Û±∏ó',
                        '40': 'Û±∏ò', '41': 'Û±∏ô', '42': 'Û±∏ö', '43': 'Û±∏õ', '44': 'Û±∏ú', '45': 'Û±∏ù',
                        '50': 'Û±∏û', '51': 'Û±∏ü', '52': 'Û±∏†', '53': 'Û±∏°', '54': 'Û±∏¢', '55': 'Û±∏£',
                    };
                {% elif format_token == 'Z' %}
                    const PAIRS = {
                        '00': '0', '01': '1', '02': '2', '03': '3', '04': '4', '05': '5',
                        '10': '6', '11': '7', '12': '8', '13': '9', '14': 'A', '15': 'B',
                        '20': 'C', '21': 'D', '22': 'E', '23': 'F', '24': 'G', '25': 'H',
                        '30': 'I', '31': 'J', '32': 'K', '33': 'L', '34': 'M', '35': 'N',
                        '40': 'O', '41': 'P', '42': 'Q', '43': 'R', '44': 'S', '45': 'T',
                        '50': 'U', '51': 'V', '52': 'W', '53': 'X', '54': 'Y', '55': 'Z',
                    };
                {% endif %}

                var time = Math.floor(seconds * 36 * 36 * 36).toString(6).padStart(6, '0');
                var uta = time.slice(0, 2);
                var posha = time.slice(2, 4);
                var agrima = time.slice(4, 6);

                {% if format_token in ('!', '@', '@!', 'Z', 'c!') %}
                    {% if locale.show_seconds %}
                        time_display = PAIRS[uta] + '{{ time_separator }}' + PAIRS[posha] + '{{ time_separator }}' + PAIRS[agrima];
                    {% else %}
                        time_display = PAIRS[uta] + '{{ time_separator }}' + PAIRS[posha];
                    {% endif %}
                {% else %}
                    {% if locale.show_seconds %}
                        time_display = uta + '{{ time_separator }}' + posha + '{{ time_separator }}' + agrima;
                    {% else %}
                        time_display = uta + '{{ time_separator }}' + posha;
                    {% endif %}
                {% endif %}

                {% if locale.RTL %}
                    time_display = '\u{2066}' + time_display + '\u{2069}';
                {% endif %}

                {% if (base == 10) and ('!' not in format_token) and locale.DIGITS %}
                    time_display = time_display.replaceAll('0', '{{ locale.DIGITS[0] }}');
                    time_display = time_display.replaceAll('1', '{{ locale.DIGITS[1] }}');
                    time_display = time_display.replaceAll('2', '{{ locale.DIGITS[2] }}');
                    time_display = time_display.replaceAll('3', '{{ locale.DIGITS[3] }}');
                    time_display = time_display.replaceAll('4', '{{ locale.DIGITS[4] }}');
                    time_display = time_display.replaceAll('5', '{{ locale.DIGITS[5] }}');
                {% endif %}

                if (document.getElementById('time_display')) {
                    document.getElementById('time_display').innerHTML = time_display;
                };

                var uta_angle = (seconds * 360);
                var posha_angle = ((seconds * 36) - Math.trunc(seconds * 36)) * 360;
                var agrima_angle = ((seconds * 36 * 36) - Math.trunc(seconds * 36 * 36)) * 360;
                document.getElementById('hand_uta').setAttribute('transform', `rotate(${uta_angle})`);
                document.getElementById('hand_posha').setAttribute('transform', `rotate(${posha_angle})`);
                document.getElementById('hand_agrima').setAttribute('transform', `rotate(${agrima_angle})`);

                //
                // Ticks light up
                //
                for (let number_1 = 0; number_1 <= 5; number_1++) {
                    for (let number_2 = 0; number_2 <= 5; number_2++) {
                        document.getElementById(`highlight_${number_1}${number_2}`).style = 'fill:#000;'
                        document.getElementById(`tick_${number_1}${number_2}`).style = 'fill:#9e9e9e;'
                    }
                }
                document.getElementById(`highlight_${uta}`).style = 'fill:#ffa726;'
                document.getElementById(`tick_${uta}`).style = 'fill:#ffa726;'
                document.getElementById(`highlight_${posha}`).style = 'fill:#ffffff;'
                document.getElementById(`tick_${posha}`).style = 'fill:#ffffff;'
                document.getElementById(`highlight_${agrima}`).style = 'fill:#d50000;'
                document.getElementById(`tick_${agrima}`).style = 'fill:#d50000;'

                //
                // Update every anuga
                //
                // setTimeout(auto_refresh_sezimal_time, 1851.851851);
                setTimeout(auto_refresh_sezimal_time, 51.440329);
            };
            auto_refresh_sezimal_time();
        {% elif base == 20 %}
            async function auto_refresh_dozenal_time(){
                var seconds = new Date().getTime();

                seconds = (seconds + ({{date.time._time_zone_offset.decimal}}  * 50000 / 27)) / 1000 / 86400;
                var seconds_hands = seconds
                seconds = seconds - Math.floor(seconds);

                var integer_time = seconds * 12 * 12 * 12;
                integer_time = Math.floor(integer_time);
                seconds = (seconds * 12 * 12 * 12) - integer_time;
                var dozenal_time = Math.floor(seconds * 12 * 12);

                {% if locale.show_seconds %}
                    time_display = integer_time.toString(12).padStart(3, '0')
                        + '{{ locale.DOZENAL_SEPARATOR }}'
                        + dozenal_time.toString(12).padStart(2, '0');
                {% else %}
                    time_display = integer_time.toString(12).padStart(3, '0');
                {% endif %}

                time_display = time_display.replaceAll('a', '‚Üä').replaceAll('b', '‚Üã');

                {% if locale.RTL %}
                    time_display = '\u{2066}' + time_display + '\u{2069}';
                {% endif %}

                if (document.getElementById('time_display')) {
                    document.getElementById('time_display').innerHTML = time_display;
                };

                seconds = seconds_hands;
                var uta_angle = (seconds * 360);
                var posha_angle = ((seconds * 12) - Math.trunc(seconds * 12)) * 360;
                var agrima_angle = ((seconds * 12 * 12) - Math.trunc(seconds * 12 * 12)) * 360;
                var dozenal_angle = ((seconds * 12 * 12 * 12) - Math.trunc(seconds * 12 * 12 * 12)) * 360;
                document.getElementById('hand_uta').setAttribute('transform', `rotate(${uta_angle})`);
                document.getElementById('hand_posha').setAttribute('transform', `rotate(${posha_angle})`);
                document.getElementById('hand_agrima').setAttribute('transform', `rotate(${agrima_angle})`);
                document.getElementById('hand_dozenal').setAttribute('transform', `rotate(${dozenal_angle})`);

                //
                // Update every 12‚Åª‚Å∂ day
                //
                setTimeout(auto_refresh_dozenal_time, 28.935518);
            };
            auto_refresh_dozenal_time();
        {% endif %}

        let weather_open = false;

        function open_close_weather() {
            weather_open = !weather_open;

            if (weather_open) {
                document.getElementById('toggle_weather').innerText = '‚ñ¥';
                document.getElementById('weather').style = 'display: inline;';
            } else {
                document.getElementById('toggle_weather').innerText = '‚ñæ';
                document.getElementById('weather').style = 'display: none;';
            };
        };

        update_weather();

        async function registerServiceWorker () {
            const swRegistration = await navigator.serviceWorker.register('/today/today_service.js'); //notice the file name
            return swRegistration;
        };

        async function requestNotificationPermission() {
            const permission = await window.Notification.requestPermission();
            return permission;
        };

        async function showLocalNotification(title, body, silent = true, alarm = false) {
            const swRegistration = await registerServiceWorker();
            const permission =  await requestNotificationPermission();

            if (permission != 'granted') {
                return;
            };

            let options = {
                body,
                icon: 'https://sezimal.tauga.online/now/icon-64.svg?{{ date.format('%Y%m%d%H%M%S') }}',
                silent: silent,
            };
            swRegistration.showNotification(title, options);
        };

        async function prepareForNotification () {
            await registerServiceWorker();
            await requestNotificationPermission();
{#
            await showLocalNotification(
                {% if locale.LANG == 'pt' %}
                'Esse √© um teste do app ‚Äú{{ TITLE }}‚Äù',
                {% elif locale.LANGUAGE_TAG in ('bz', 'en-BR', 'pt-BR') %}
                'Esi √® un t√®sti du app ‚Äú{{ TITLE }}‚Äù',
                {% else %}
                'This is a test from the ‚Äú{{ TITLE }}‚Äù app',
                {% endif %}

                {% if locale.LANG == 'pt' %}
                'Testando as notifica√ß√µes, como outros apps de alarme e tempo',
                {% elif locale.LANGUAGE_TAG in ('bz', 'en-BR', 'pt-BR') %}
                'Testandu as notifikasoyns, komu otrus apss di alarmi i tenpu',
                {% else %}
                'Testing notifications, like other alarm and weather apps',
                {% endif %}
            );
#}
        };

        prepareForNotification();

        var initialTouchX, initialTouchY, finalTouchX, finalTouchY;
        const swipeThreshold = 100;

        function handleTouch(startX, endX) {
            const horizontalDistance = finalTouchX - initialTouchX;
            const verticalDistance = finalTouchY - initialTouchY;

            if (
                (Math.abs(horizontalDistance) > Math.abs(verticalDistance))
                 && (Math.abs(horizontalDistance) > swipeThreshold)) {
                //
                // Swipe to the left:
                // Stopwatch -> Clock -> Timer
                //
                if (finalTouchX - initialTouchX < 0) {
                    if (!document.getElementById('stopwatch-content').hidden) {
                        document.getElementById('stopwatch-content').hidden = true;
                        document.getElementById('now-content').hidden = false;
                        document.getElementById('timer-content').hidden = true;
                    } else if (!document.getElementById('now-content').hidden) {
                        document.getElementById('stopwatch-content').hidden = true;
                        document.getElementById('now-content').hidden = true;
                        document.getElementById('timer-content').hidden = false;
                    } else if (!document.getElementById('timer-content').hidden) {
                        document.getElementById('stopwatch-content').hidden = false;
                        document.getElementById('now-content').hidden = true;
                        document.getElementById('timer-content').hidden = true;
                    };
                }
                //
                // Swipe to the right
                // Stopwatch <- Clock <- Timer
                //
                else {
                    if (!document.getElementById('timer-content').hidden) {
                        document.getElementById('stopwatch-content').hidden = true;
                        document.getElementById('now-content').hidden = false;
                        document.getElementById('timer-content').hidden = true;
                    } else if (!document.getElementById('now-content').hidden) {
                        document.getElementById('stopwatch-content').hidden = false;
                        document.getElementById('now-content').hidden = true;
                        document.getElementById('timer-content').hidden = true;
                    } else if (!document.getElementById('stopwatch-content').hidden) {
                        document.getElementById('stopwatch-content').hidden = true;
                        document.getElementById('now-content').hidden = true;
                        document.getElementById('timer-content').hidden = false;
                    };
                }
            }
        };

        window.onload = function () {
            window.addEventListener(
                'touchstart',
                function (event) {
                    initialTouchX = event.touches[0].clientX;
                    initialTouchY = event.touches[0].clientY;
                }
            );

            window.addEventListener(
                'touchend',
                function (event) {
                    finalTouchX = event.changedTouches[0].clientX;
                    finalTouchY = event.changedTouches[0].clientY;
                    handleTouch(initialTouchX, finalTouchX);
                }
            );
        };

        var stopwatch_start_time = null;
        var stopwatch_paused_time = null;
        var stopwatch_discount_time = 0;
        var stopwatch_timeout = null;

        function stopwatch_update() {
            if (stopwatch_start_time == null) {
                stopwatch_start_time = Date.now();
            }

            var seconds_passed = (Date.now() - stopwatch_start_time - stopwatch_discount_time) / 1000;
            var seconds = seconds_passed;

            var hour = Math.floor(seconds / 60 / 60);
            seconds = seconds - (hour * 60 * 60);
            var minute = Math.floor(seconds / 60);
            seconds = seconds - (minute * 60);
            var second = Math.floor(seconds);
            seconds = seconds - second
            var centisecond = Math.floor(seconds * 100);

            var stopwatch_iso_display =
                hour.toString().padStart(2, '0') + '{{ locale.TIME_SEPARATOR }}' +
                minute.toString().padStart(2, '0') + '{{ locale.TIME_SEPARATOR }}' +
                second.toString().padStart(2, '0') + '{{ locale.DECIMAL_SEPARATOR }}' +
                centisecond.toString().padStart(2, '0');

            {% if locale.base == 10 %}
                var days = seconds_passed / 86400;

                var uta = Math.floor(days * 36);
                days = (days * 36) - uta;
                var posha = Math.floor(days * 36);
                days = (days * 36) - posha;
                var agrima = Math.floor(days * 36);
                days = (days * 36) - agrima;
                var anuga = Math.floor(days * 36);

                var stopwatch_display =
                    uta.toString(6).padStart(2, '0') + '{{ time_separator }}' +
                    posha.toString(6).padStart(2, '0') + '{{ time_separator }}' +
                    agrima.toString(6).padStart(2, '0') + '{{ sezimal_separator }}' +
                    anuga.toString(6).padStart(2, '0');

                {% if '!' in locale.format_token %}
                    stopwatch_display = stopwatch_display.
                        replaceAll('0', 'Û±∏Ä').
                        replaceAll('1', 'Û±∏Å').
                        replaceAll('2', 'Û±∏Ç').
                        replaceAll('3', 'Û±∏É').
                        replaceAll('4', 'Û±∏Ñ').
                        replaceAll('5', 'Û±∏Ö').
                        replaceAll('&#8Û±∏ÇÛ±∏ÄÛ±∏Ä;', '&#8200;');
                {% endif %}

            {% elif locale.base == 20 %}
                var days = seconds_passed / 86400;

                var integer_time = Math.floor(days * 12 * 12 * 12);
                days = (days * 12 * 12 * 12) - integer_time;
                var fraction_time = Math.floor(days * 12 * 12 * 12);

                var stopwatch_display =
                    integer_time.toString(12).padStart(3, '0') + '{{ locale.DOZENAL_SEPARATOR }}' +
                    fraction_time.toString(12).padStart(3, '0');

                stopwatch_display = stopwatch_display.replaceAll('a', '‚Üä').replaceAll('b', '‚Üã');
            {% else %}
                var stopwatch_display = stopwatch_iso_display;
            {% endif %}

            document.getElementById('stopwatch_display').innerHTML = stopwatch_display;
            document.getElementById('stopwatch_iso_display').innerHTML = stopwatch_iso_display;

            stopwatch_timeout = setTimeout(stopwatch_update, 1);
        }

        function stopwatch_start() {
            if (stopwatch_start_time == null) {
                stopwatch_start_time = Date.now();
            } else if (stopwatch_paused_time !== null) {
                stopwatch_discount_time += Date.now() - stopwatch_paused_time;
            }

            stopwatch_paused_time = null;

            document.getElementById('stopwatch_play').hidden = true;
            document.getElementById('stopwatch_pause').hidden = false;
            document.getElementById('stopwatch_reset').hidden = true;

            stopwatch_update();
        };

        function stopwatch_reset() {
            stopwatch_start_time = null;
            stopwatch_paused_time = null;
            stopwatch_discount_time = 0;
            clearTimeout(stopwatch_timeout);

            document.getElementById('stopwatch_play').hidden = false;
            document.getElementById('stopwatch_pause').hidden = true;
            document.getElementById('stopwatch_reset').hidden = true;

            {% if locale.base == 10 %}
                {% if '!' in locale.format_token %}
                    document.getElementById('stopwatch_display').innerHTML = 'Û±∏ÄÛ±∏Ä{{ time_separator }}Û±∏ÄÛ±∏Ä{{ time_separator }}Û±∏ÄÛ±∏Ä{{ sezimal_separator }}Û±∏ÄÛ±∏Ä';
                {% else %}
                    document.getElementById('stopwatch_display').innerHTML = '00{{ time_separator }}00{{ time_separator }}00{{ sezimal_separator }}00';
                {% endif %}
            {% else %}
                document.getElementById('stopwatch_display').innerHTML = '000{{ locale.DECIMAL_SEPARATOR }}00';
            {% endif %}
            document.getElementById('stopwatch_iso_display').innerHTML = '00{{ locale.TIME_SEPARATOR }}00{{ locale.TIME_SEPARATOR }}00{{ locale.DECIMAL_SEPARATOR }}00';
        }

        function stopwatch_pause() {
            stopwatch_paused_time = Date.now();
            clearTimeout(stopwatch_timeout);

            document.getElementById('stopwatch_play').hidden = false;
            document.getElementById('stopwatch_pause').hidden = true;

            if (stopwatch_start_time == null) {
                document.getElementById('stopwatch_reset').hidden = true;
            } else {
                document.getElementById('stopwatch_reset').hidden = false;
            };
        }

        var timer_time_uta = 0;
        var timer_time_posha = 0;
        var timer_time_agrima = 0;
        var timer_time_anuga = 0;
        var timer_time_boda = 0;
        var timer_time_ekatiboda = 0;

        var timer_time_set_seconds = 0;
        var timer_start_time = null;
        var timer_paused_time = null;
        var timer_discount_time = 0;
        var timer_timeout = null;
        var timer_music_playing = false;

        function set_timer() {
            {% if locale.base == 10 %}
                var timer_time_display = '&#8200;' +
                    timer_time_uta.toString(6).padStart(2, '0') + '{{ time_separator }}' +
                    timer_time_posha.toString(6).padStart(2, '0') + '{{ time_separator }}' +
                    timer_time_agrima.toString(6).padStart(2, '0') + '{{ sezimal_separator }}' +
                    timer_time_anuga.toString(6).padStart(2, '0');

                {% if '!' in locale.format_token %}
                    timer_time_display = timer_time_display.
                        replaceAll('0', 'Û±∏Ä').
                        replaceAll('1', 'Û±∏Å').
                        replaceAll('2', 'Û±∏Ç').
                        replaceAll('3', 'Û±∏É').
                        replaceAll('4', 'Û±∏Ñ').
                        replaceAll('5', 'Û±∏Ö').
                        replaceAll('&#8Û±∏ÇÛ±∏ÄÛ±∏Ä;', '&#8200;');
                {% endif %}

                var anuga =
                    timer_time_uta * 36 * 36 * 36 +
                    timer_time_posha * 36 * 36 +
                    timer_time_agrima * 36 +
                    timer_time_anuga;

                timer_time_set_seconds = anuga * 25 / 486;

                var hour = Math.floor(anuga / 69984);
                anuga = anuga - (hour * 69984);
                var minute = Math.floor(anuga * 5 / 5832);
                anuga = anuga - (minute / 5 * 5832);
                var second = Math.floor(anuga * 25 / 486);
                anuga = anuga - (second / 25 * 486);
                var centisecond = Math.floor(anuga * 1250 / 243);

            {% elif locale.base == 20 %}
                var timer_time_display = '&#8200;' +
                    timer_time_uta.toString(12).padStart(1, '0') +
                    timer_time_posha.toString(12).padStart(1, '0') +
                    timer_time_agrima.toString(12).padStart(1, '0') + '{{ sezimal_separator }}' +
                    timer_time_anuga.toString(12).padStart(1, '0') +
                    timer_time_boda.toString(12).padStart(1, '0') +
                    timer_time_ekatiboda.toString(12).padStart(1, '0');

                timer_time_display = timer_time_display.replaceAll('a', '‚Üä').replaceAll('b', '‚Üã');

                var anuga =
                    timer_time_uta * 12 * 12 * 12 +
                    timer_time_posha * 12 * 12 +
                    timer_time_agrima * 12 +
                    timer_time_anuga +
                    timer_time_boda / 12 +
                    timer_time_ekatiboda / 12 / 12;

                timer_time_set_seconds = anuga * 25 / 6;

                var hour = Math.floor(anuga / 864);
                anuga = anuga - (hour * 864);
                var minute = Math.floor(anuga * 10 / 144);
                anuga = anuga - (minute * 144 / 10);
                var second = Math.floor(anuga * 600 / 144);
                anuga = anuga - (second * 144 / 600);
                var centisecond = Math.floor(anuga * 1250 / 3);
            {% else %}
            {% endif %}

            var timer_iso_display = '&#8200;' +
                hour.toString().padStart(2, '0') + '{{ time_separator }}' +
                minute.toString().padStart(2, '0') + '{{ time_separator }}' +
                second.toString().padStart(2, '0') + '{{ sezimal_separator }}' +
                centisecond.toString().padStart(2, '0');

            document.getElementById('timer_display').innerHTML = timer_time_display;
            document.getElementById('timer_iso_display').innerHTML = timer_iso_display;
        }

        function timer_uta(sign='+') {
            if (sign == '+') {
                timer_time_uta += 1;

                {% if locale.base == 10 %}
                    if (timer_time_uta >= 36) {
                        timer_time_uta = 0;
                    }
                {% elif locale.base == 20 %}
                    if (timer_time_uta >= 12) {
                        timer_time_uta = 0;
                    }
                {% else %}
                    if (timer_time_uta >= 24) {
                        timer_time_uta = 0;
                    }
                {% endif %}
            } else {
                timer_time_uta -= 1;
                {% if locale.base == 10 %}
                    if (timer_time_uta < 0) {
                        timer_time_uta = 35;
                    }
                {% elif locale.base == 20 %}
                    if (timer_time_uta < 0) {
                        timer_time_uta = 11;
                    }
                {% else %}
                    if (timer_time_uta < 0) {
                        timer_time_uta = 23;
                    }
                {% endif %}
            }

            set_timer();
        };

        function timer_posha(sign='+') {
            if (sign == '+') {
                timer_time_posha += 1;

                {% if locale.base == 10 %}
                    if (timer_time_posha >= 36) {
                        timer_time_posha = 0;
                    }
                {% elif locale.base == 20 %}
                    if (timer_time_posha >= 12) {
                        timer_time_posha = 0;
                    }
                {% else %}
                    if (timer_time_posha >= 60) {
                        timer_time_posha = 0;
                    }
                {% endif %}
            } else {
                timer_time_posha -= 1;
                {% if locale.base == 10 %}
                    if (timer_time_posha < 0) {
                        timer_time_posha = 35;
                    }
                {% elif locale.base == 20 %}
                    if (timer_time_posha < 0) {
                        timer_time_posha = 11;
                    }
                {% else %}
                    if (timer_time_posha < 0) {
                        timer_time_posha = 59;
                    }
                {% endif %}
            }

            set_timer();
        };

        function timer_agrima(sign='+') {
            if (sign == '+') {
                timer_time_agrima += 1;

                {% if locale.base == 10 %}
                    if (timer_time_agrima >= 36) {
                        timer_time_agrima = 0;
                    }
                {% elif locale.base == 20 %}
                    if (timer_time_agrima >= 12) {
                        timer_time_agrima = 0;
                    }
                {% else %}
                    if (timer_time_agrima >= 60) {
                        timer_time_agrima = 0;
                    }
                {% endif %}
            } else {
                timer_time_agrima -= 1;
                {% if locale.base == 10 %}
                    if (timer_time_agrima < 0) {
                        timer_time_agrima = 35;
                    }
                {% elif locale.base == 20 %}
                    if (timer_time_agrima < 0) {
                        timer_time_agrima = 11;
                    }
                {% else %}
                    if (timer_time_agrima < 0) {
                        timer_time_agrima = 59;
                    }
                {% endif %}
            }

            set_timer();
        };

        function timer_anuga(sign='+') {
            if (sign == '+') {
                timer_time_anuga += 1;

                {% if locale.base == 10 %}
                    if (timer_time_anuga >= 36) {
                        timer_time_anuga = 0;
                    }
                {% elif locale.base == 20 %}
                    if (timer_time_anuga >= 12) {
                        timer_time_anuga = 0;
                    }
                {% else %}
                    if (timer_time_anuga >= 60) {
                        timer_time_anuga = 0;
                    }
                {% endif %}
            } else {
                timer_time_anuga -= 1;
                {% if locale.base == 10 %}
                    if (timer_time_anuga < 0) {
                        timer_time_anuga = 35;
                    }
                {% elif locale.base == 20 %}
                    if (timer_time_anuga < 0) {
                        timer_time_anuga = 11;
                    }
                {% else %}
                    if (timer_time_anuga < 0) {
                        timer_time_anuga = 59;
                    }
                {% endif %}
            }

            set_timer();
        };

        function timer_boda(sign='+') {
            if (sign == '+') {
                timer_time_boda += 1;

                {% if locale.base == 10 %}
                    if (timer_time_boda >= 36) {
                        timer_time_boda = 0;
                    }
                {% elif locale.base == 20 %}
                    if (timer_time_boda >= 12) {
                        timer_time_boda = 0;
                    }
                {% else %}
                    if (timer_time_boda >= 60) {
                        timer_time_boda = 0;
                    }
                {% endif %}
            } else {
                timer_time_boda -= 1;
                {% if locale.base == 10 %}
                    if (timer_time_boda < 0) {
                        timer_time_boda = 35;
                    }
                {% elif locale.base == 20 %}
                    if (timer_time_boda < 0) {
                        timer_time_boda = 11;
                    }
                {% else %}
                    if (timer_time_boda < 0) {
                        timer_time_boda = 59;
                    }
                {% endif %}
            }

            set_timer();
        };

        function timer_ekatiboda(sign='+') {
            if (sign == '+') {
                timer_time_ekatiboda += 1;

                {% if locale.base == 10 %}
                    if (timer_time_ekatiboda >= 36) {
                        timer_time_ekatiboda = 0;
                    }
                {% elif locale.base == 20 %}
                    if (timer_time_ekatiboda >= 12) {
                        timer_time_ekatiboda = 0;
                    }
                {% else %}
                    if (timer_time_ekatiboda >= 60) {
                        timer_time_ekatiboda = 0;
                    }
                {% endif %}
            } else {
                timer_time_ekatiboda -= 1;
                {% if locale.base == 10 %}
                    if (timer_time_ekatiboda < 0) {
                        timer_time_ekatiboda = 35;
                    }
                {% elif locale.base == 20 %}
                    if (timer_time_ekatiboda < 0) {
                        timer_time_ekatiboda = 11;
                    }
                {% else %}
                    if (timer_time_ekatiboda < 0) {
                        timer_time_ekatiboda = 59;
                    }
                {% endif %}
            }

            set_timer();
        };

        function timer_update() {
            if (timer_start_time == null) {
                timer_start_time = Date.now();
            }

            var seconds_passed = timer_time_set_seconds - ((Date.now() - timer_start_time - timer_discount_time) / 1000);

            var sign = '&#8200;';
            var sign_iso = '&#8200;';

            if (seconds_passed < 0) {
                sign = '‚àí';
                sign_iso = '‚àí';
                seconds_passed = seconds_passed * -1;
            }

            var seconds = Math.abs(seconds_passed);

            var hour = Math.floor(seconds / 60 / 60);
            seconds = seconds - (hour * 60 * 60);
            var minute = Math.floor(seconds / 60);
            seconds = seconds - (minute * 60);
            var second = Math.floor(seconds);
            seconds = seconds - second;
            var centisecond = Math.floor(seconds * 100);

            if ((hour == 0) && (minute == 0) && (second == 0) && (centisecond == 0)) {
                sign_iso = '&#8200;';
            };

            var timer_iso_display = sign_iso +
                hour.toString().padStart(2, '0') + '{{ locale.TIME_SEPARATOR }}' +
                minute.toString().padStart(2, '0') + '{{ locale.TIME_SEPARATOR }}' +
                second.toString().padStart(2, '0') + '{{ locale.DECIMAL_SEPARATOR }}' +
                centisecond.toString().padStart(2, '0');

            {% if locale.base == 10 %}
                var days = seconds_passed / 86400;

                var uta = Math.floor(days * 36);
                days = (days * 36) - uta;
                var posha = Math.floor(days * 36);
                days = (days * 36) - posha;
                var agrima = Math.floor(days * 36);
                days = (days * 36) - agrima;
                var anuga = Math.floor(days * 36);

                if ((uta == 0) && (posha == 0) && (agrima == 0) && (anuga == 0)) {
                    sign = '&#8200;';
                };

                var timer_display = sign +
                    uta.toString(6).padStart(2, '0') + '{{ time_separator }}' +
                    posha.toString(6).padStart(2, '0') + '{{ time_separator }}' +
                    agrima.toString(6).padStart(2, '0') + '{{ sezimal_separator }}' +
                    anuga.toString(6).padStart(2, '0');

                {% if '!' in locale.format_token %}
                    timer_display = timer_display.
                        replaceAll('0', 'Û±∏Ä').
                        replaceAll('1', 'Û±∏Å').
                        replaceAll('2', 'Û±∏Ç').
                        replaceAll('3', 'Û±∏É').
                        replaceAll('4', 'Û±∏Ñ').
                        replaceAll('5', 'Û±∏Ö').
                        replaceAll('&#8Û±∏ÇÛ±∏ÄÛ±∏Ä;', '&#8200;');
                {% endif %}

            {% elif locale.base == 20 %}
                var days = seconds_passed / 86400;
                var dias = days;

                var integer_time = Math.floor(days * 12 * 12 * 12);
                days = (days * 12 * 12 * 12) - integer_time;
                var fraction_time = Math.floor(days * 12 * 12 * 12);

                if ((integer_time == 0) && (fraction_time == 0)) {
                    sign = '&#8200;';
                };

                var timer_display = sign +
                    integer_time.toString(12).padStart(3, '0') + '{{ sezimal_separator }}' +
                    fraction_time.toString(12).padStart(3, '0');

                timer_display = timer_display.replaceAll('a', '‚Üä').replaceAll('b', '‚Üã');

            {% else %}
                var timer_display = timer_iso_display;
            {% endif %}

            if (
                (
                    (timer_time_uta != 0)
                    || (timer_time_posha != 0)
                    || (timer_time_agrima != 0)
                    || (timer_time_anuga != 0)
                    || (timer_time_boda != 0)
                    || (timer_time_ekatiboda != 0)
                ) && (sign == '‚àí') && (!timer_music_playing)
            ) {
                timer_music_playing = true;
                document.getElementById('audio').play();
            }

            document.getElementById('timer_display').innerHTML = timer_display;
            document.getElementById('timer_iso_display').innerHTML = timer_iso_display;

            timer_timeout = setTimeout(timer_update, 1);
        }

        function timer_start() {
            if (timer_start_time == null) {
                timer_start_time = Date.now();
            } else if (timer_paused_time !== null) {
                timer_discount_time += Date.now() - timer_paused_time;
            }

            timer_paused_time = null;

            document.getElementById('timer_play').hidden = true;
            document.getElementById('timer_pause').hidden = false;
            document.getElementById('timer_reset').hidden = true;
            document.getElementById('timer_add').hidden = true;
            document.getElementById('timer_subtract').hidden = true;

            timer_update();
        };

        function timer_reset() {
            timer_start_time = null;
            timer_paused_time = null;
            timer_discount_time = 0;
            timer_time_uta = 0;
            timer_time_posha = 0;
            timer_time_agrima = 0;
            timer_time_anuga = 0;
            timer_time_boda = 0;
            timer_time_ekatiboda = 0;
            timer_time_set_seconds = 0;
            clearTimeout(timer_timeout);

            document.getElementById('timer_play').hidden = false;
            document.getElementById('timer_pause').hidden = true;
            document.getElementById('timer_reset').hidden = true;
            document.getElementById('timer_add').hidden = false;
            document.getElementById('timer_subtract').hidden = false;

            if (timer_music_playing) {
                timer_music_playing = false;
                document.getElementById('audio').pause();
            }

            {% if locale.base == 10 %}
                {% if '!' in locale.format_token %}
                    document.getElementById('timer_display').innerHTML = '&#8200;Û±∏ÄÛ±∏Ä{{ time_separator }}Û±∏ÄÛ±∏Ä{{ time_separator }}Û±∏ÄÛ±∏Ä{{ sezimal_separator }}Û±∏ÄÛ±∏Ä';
                {% else %}
                    document.getElementById('timer_display').innerHTML = '&#8200;00{{ time_separator }}00{{ time_separator }}00{{ sezimal_separator }}00';
                {% endif %}
            {% else %}
                document.getElementById('timer_display').innerHTML = '&#8200;000{{ sezimal_separator }}000';
            {% endif %}
            document.getElementById('timer_iso_display').innerHTML = '&#8200;00:00:00{{ sezimal_separator }}00';
        }

        function timer_pause() {
            timer_paused_time = Date.now();
            clearTimeout(timer_timeout);

            if (timer_music_playing) {
                timer_music_playing = false;
                document.getElementById('audio').pause();
            }

            document.getElementById('timer_play').hidden = false;
            document.getElementById('timer_pause').hidden = true;

            if (timer_start_time == null) {
                document.getElementById('timer_reset').hidden = true;
            } else {
                document.getElementById('timer_reset').hidden = false;
            };
        }

        const browser_is_touchable = 'ontouchstart' in window ||
            (window.DocumentTouch && document instanceof window.DocumentTouch) ||
            navigator.maxTouchPoints > 0 ||
            window.navigator.msMaxTouchPoints > 0;

        if (!browser_is_touchable) {
            document.getElementById('show_stopwath').hidden = false;
            document.getElementById('show_timer').hidden = false;
        }

        function show_stopwath() {
            document.getElementById('show_stopwath').hidden = true;
            document.getElementById('show_clock_stopwatch').hidden = false;
            document.getElementById('show_clock_timer').hidden = true;
            document.getElementById('show_timer').hidden = true;

            document.getElementById('stopwatch-content').hidden = false;
            document.getElementById('now-content').hidden = true;
            document.getElementById('timer-content').hidden = true;
        }

        function show_clock() {
            document.getElementById('show_stopwath').hidden = false;
            document.getElementById('show_clock_stopwatch').hidden = true;
            document.getElementById('show_clock_timer').hidden = true;
            document.getElementById('show_timer').hidden = false;

            document.getElementById('stopwatch-content').hidden = true;
            document.getElementById('now-content').hidden = false;
            document.getElementById('timer-content').hidden = true;
        }

        function show_timer() {
            document.getElementById('show_stopwath').hidden = true;
            document.getElementById('show_clock_stopwatch').hidden = true;
            document.getElementById('show_clock_timer').hidden = false;
            document.getElementById('show_timer').hidden = true;

            document.getElementById('stopwatch-content').hidden = true;
            document.getElementById('now-content').hidden = true;
            document.getElementById('timer-content').hidden = false;
        }

        function watchface_toggle() {
            document.getElementById('watchface_div').hidden = !document.getElementById('watchface_div').hidden;
            document.getElementById('time_display').hidden = !document.getElementById('time_display').hidden;
            document.getElementById('natural_time_container').hidden = !document.getElementById('natural_time_container').hidden;
            document.getElementById('weekday').hidden = !document.getElementById('weekday').hidden;
            document.getElementById('date').hidden = !document.getElementById('date').hidden;
            document.getElementById('filler').hidden = !document.getElementById('filler').hidden;
            document.getElementById('now-calendar').hidden = !document.getElementById('now-calendar').hidden;

            if (document.getElementById('watchface_div').hidden) {
                localStorage.setItem('sezimal-watchface', 'digital');
            } else {
                localStorage.setItem('sezimal-watchface', 'analog');
            };
        }

    var latitude = 0;
    var moon_tilt = 0;

    if (
        (localStorage.getItem('sezimal-latitude') != null)
        && (localStorage.getItem('sezimal-latitude') != 'null')
    ) {
        latitude = parseFloat(localStorage.getItem('sezimal-latitude'));
    } else if (
        (localStorage.getItem('sezimal-gps-latitude') != null)
        && (localStorage.getItem('sezimal-gps-latitude') != 'null')
    ) {
        latitude = parseFloat(localStorage.getItem('sezimal-gps-latitude'));
    };

    if (latitude > 0) {
        if (localStorage.getItem('sezimal-calendar-hemisphere') == 'S') {
            latitude = latitude * -1;
        };
    } else if (latitude < 0) {
        if (localStorage.getItem('sezimal-calendar-hemisphere') == 'N') {
            latitude = latitude * -1;
        };
    };

    if (latitude > 0) {
        moon_tilt = 360 - Math.abs(latitude);
    } else if (latitude < 0) {
        moon_tilt = 90 - Math.abs(latitude);
    };

    document.getElementById('moon-style').innerHTML = `.moon-emoji {
    display: inline-block;
    transform: rotate(${moon_tilt}deg);



}`;

    var watchface = localStorage.getItem('sezimal-watchface');
    if ((watchface === null) || (watchface == 'digital')) {
        document.getElementById('watchface_div').hidden = true;
        document.getElementById('time_display').hidden = false;
        document.getElementById('natural_time_container').hidden = false;
        document.getElementById('weekday').hidden = false;
        document.getElementById('date').hidden = false;
        document.getElementById('filler').hidden = true;
        document.getElementById('now-calendar').hidden = false;
    } else {
        document.getElementById('watchface_div').hidden = false;
        document.getElementById('time_display').hidden = true;
        document.getElementById('natural_time_container').hidden = true;
        document.getElementById('weekday').hidden = true;
        document.getElementById('date').hidden = true;
        document.getElementById('filler').hidden = false;
        document.getElementById('now-calendar').hidden = true;
    };

    function open_today() {
        window.open('/today', '_blank');
    };

    </script>
</html>
