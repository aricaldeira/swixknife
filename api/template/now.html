{% set
    NOW_TRANSLATIONS = {
        'ar': 'دلوقتي',
        'bn': 'এখন',
        'bz': 'Agòra',
        'ca': 'Ara',
        'cy': 'Yn Awr',
        'da': 'Nu',
        'de': 'Jetzt',
        'ee': 'Nüüd',
        'el': 'Τώρα',
        'en': 'Now',
        'eo': 'Nun',
        'es': 'Ahora',
        'fa': 'حالا',
        'fi': 'Nyt',
        'fr': 'Maintenant',
        'ga': 'Anois',
        'gl': 'Agora',
        'gn': 'Koꞌág̃a',
        'he': 'עכשיו',
        'hi': 'अब',
        'hu': 'Most',
        'id': 'Kini',
        'is': 'Nú',
        'it': 'Adesso',
        'iu': 'ᒫᓐᓇ',
        'ja': '今',
        'kea': 'Agora',
        'kn': 'ಈಗ',
        'ko': '지금',
        'lat': 'Nunc',
        'lb': 'Elo',
        'mt': 'Issa',
        'nb': 'Nå',
        'nl': 'Nu',
        'nn': 'No',
        'pl': 'Teraz',
        'pt': 'Agora',
        'ro': 'Acum',
        'ru': 'Сейчас',
        'sv': 'Nu',
        'sw': 'Sasa',
        'tr': 'Şimdi',
        'uk': 'Тепер',
        'vi': 'Bây giờ',
        'yo': 'Báyìí',
        'zh': '現在',
        'zh_CN': '现在',
    }
%}
{% set TITLE = NOW_TRANSLATIONS[locale.LANG] if locale.LANG in NOW_TRANSLATIONS else 'Now' %}
{% if locale.base == 10 %}
    {% if '!' in locale.format_token %}
        {% set time_separator = '󱹷' %}
    {% else %}
        {% set time_separator = locale.TIME_SEPARATOR %}
    {% endif %}
    {% set sezimal_separator = '󱹮' %}
{% else %}
    {% set time_separator = locale.TIME_SEPARATOR %}
    {% set sezimal_separator = locale.SEZIMAL_SEPARATOR %}
{% endif %}
<!doctype html>
<html lang="{{ locale.LANGUAGE_TAG }}" dir="{{ 'rtl' if locale.RTL else 'ltr' }}">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title id="title">{{ TITLE }}</title>
        <meta name="description" content="{{ TITLE }}" />
        <meta name="author" content="Ari Caldeira" />
        {% include 'sezimal_css.html' %}
        <link rel="manifest" href="https://sezimal.tauga.online/now/manifest.json?{{ date.format('%Y%m%d%H%M%S') }}" crossorigin="use-credentials" />
        <link rel="icon" type="image/svg+xml" href="https://sezimal.tauga.online/now/icon-64.svg?{{ date.format('%Y%m%d%H%M%S') }}" />
<style>
html, body {
    max-width: 100%;
    width: 100%;
    margin: auto;
}
</style>
    </head>
    <body>
    <div id="selectors" style="position: absolute; width: 100%">
        <!-- Stopwatch selectors -->
        <span id="show_stopwath" class="emoji" style="float: left; opacity: 0.5; text-align: left;" onclick="show_stopwath()" hidden> ⏱️ </span>
        <span id="show_clock_stopwatch" class="emoji" style="float: right; opacity: 0.5; text-align: right;" onclick="show_clock()" hidden> ⌚ </span>

        <!-- Timer selectors -->
        <span id="show_clock_timer" class="emoji" style="float: left; opacity: 0.5; text-align: right;" onclick="show_clock()" hidden> ⌚ </span>
        <span id="show_timer" class="emoji" style="float: right; opacity: 0.5; text-align: right;" onclick="show_timer()" hidden> ⏳ </span>
    </div>
    <div id="now_view">
    {% include 'calendar_view_now.html' %}
    </div>
    <div style="display: none;">
        <audio id="audio">
            <source src="https://midia.tauga.online/audio/sezimal/hexagon.ogg" type="audio/ogg" preload="auto" />
            <source src="https://midia.tauga.online/audio/sezimal/hexagon.mp3" type="audio/mpeg" preload="auto" />
            <source src="https://midia.tauga.online/audio/sezimal/hexagon.wav" type="audio/wav" preload="auto" />
        </audio>
    </div>
    </body>
    <script src="/static/js/calendar_today_api.js"></script>
    <script>
        if ((navigator.userAgent.toUpperCase().indexOf('MOBILE') > 0) || (navigator.userAgent.toUpperCase().indexOf('ANDROID') > 0)) {
            document.querySelector("body").requestFullscreen();
        };
        {% if force_decimal %}
            localStorage.setItem('sezimal-calendar-base', '14');
            localStorage.setItem('sezimal-calendar-format-token', '9');
        {% elif force_dozenal %}
            localStorage.setItem('sezimal-calendar-base', '20');
            localStorage.setItem('sezimal-calendar-format-token', '↋');
        {% endif %}

        var time_display = '';
        var iso_time_display = '';

        async function auto_refresh_iso_display(){
            var date = new Date();
            var seconds = date.getTime();
            var show_local_time = ({{date.time._time_zone_offset.decimal}} * 50000 / 27) != (date.getTimezoneOffset() * -60 * 1000);

            seconds = (seconds + ({{date.time._time_zone_offset.decimal}} * 50000 / 27)) / 1000 / 86400;
            seconds = seconds - Math.floor(seconds);

            var sec = Math.floor(seconds * 60 * 60 * 24);

            var hours = Math.floor(sec / 60 / 60);
            sec = sec - (hours * 60 * 60);

            var minutes = Math.floor(sec / 60);
            sec = sec - (minutes * 60);
            sec = Math.floor(sec);

            minutes = minutes.toString().padStart(2, '0');
            sec = sec.toString().padStart(2, '0');

            var hours_24 = hours.toString().padStart(2, '0');

            {% if locale.HOUR_FORMAT == '12h' %}
                if (hours > 12) {
                    hours = hours - 12;
                    {% if locale.show_seconds %}
                        sec = sec + ' {{ locale.lower(locale.PM) }}';
                    {% else %}
                        minutes = minutes + ' {{ locale.lower(locale.PM) }}';
                    {% endif %}
                } else if (hours == 12) {
                    {% if locale.show_seconds %}
                        sec = sec + ' {{ locale.lower(locale.PM) }}';
                    {% else %}
                        minutes = minutes + ' {{ locale.lower(locale.PM) }}';
                    {% endif %}
                } else {
                    {% if locale.show_seconds %}
                        sec = sec + ' {{ locale.lower(locale.AM) }}';
                    {% else %}
                        minutes = minutes + ' {{ locale.lower(locale.AM) }}';
                    {% endif %}
                };
            {% endif %}

            hours = hours.toString().padStart(2, '0');

            {% if locale.RTL %}
                {% if locale.show_seconds %}
                    iso_time_display = '\u{2066}' + hours + '{{ locale.TIME_SEPARATOR }}' + minutes + '{{ locale.TIME_SEPARATOR }}' + sec + '\u{2069}';
                {% else %}
                    iso_time_display = '\u{2066}' + hours + '{{ locale.TIME_SEPARATOR }}' + minutes + '\u{2069}';
                {% endif %}
            {% else %}
                {% if locale.show_seconds %}
                    iso_time_display = hours + '{{ locale.TIME_SEPARATOR }}' + minutes + '{{ locale.TIME_SEPARATOR }}' + sec;
                {% else %}
                    iso_time_display = hours + '{{ locale.TIME_SEPARATOR }}' + minutes;
                {% endif %}
            {% endif %}

            if ((show_local_time) && ({{locale.base}} != 14)) {
                {% if locale.show_seconds %}
                    iso_time_display = iso_time_display + ' (' + date.toLocaleTimeString('{{ locale.LANGUAGE_TAG }}').toLowerCase() + ')';
                {% else %}
                    iso_time_display = iso_time_display + ' (' + date.toLocaleTimeString('{{ locale.LANGUAGE_TAG }}', {hour: '2-digit', minute:'2-digit'}).toLowerCase() + ')';
                {% endif %}
            };

            var time_passed = (date.getHours() * 60) + date.getMinutes();

            {% if '/NT4' in locale.DEFAULT_TIME_ZONE or '/NT10'  in locale.DEFAULT_TIME_ZONE or '/NT20' in locale.DEFAULT_TIME_ZONE %}
                if (time_passed < 240) {
                    time_passed = time_passed + 1200;
                } else {
                    time_passed = time_passed - 240;
                }

                if (time_passed < 120) {
                    document.getElementById('natural_time_sunrise').hidden = false;
                    document.getElementById('natural_time_sun').hidden = true;
                    document.getElementById('natural_time_sunset').hidden = true;
                    document.getElementById('natural_time_stars').hidden = true;
                } else if (time_passed < 780) {
                    document.getElementById('natural_time_sunrise').hidden = true;
                    document.getElementById('natural_time_sun').hidden = false;
                    document.getElementById('natural_time_sunset').hidden = true;
                    document.getElementById('natural_time_stars').hidden = true;
                } else if (time_passed < 870) {
                    document.getElementById('natural_time_sunrise').hidden = true;
                    document.getElementById('natural_time_sun').hidden = true;
                    document.getElementById('natural_time_sunset').hidden = false;
                    document.getElementById('natural_time_stars').hidden = true;
                } else if (time_passed < 1410) {
                    document.getElementById('natural_time_sunrise').hidden = true;
                    document.getElementById('natural_time_sun').hidden = true;
                    document.getElementById('natural_time_sunset').hidden = true;
                    document.getElementById('natural_time_stars').hidden = false;
                } else {
                    document.getElementById('natural_time_sunrise').hidden = false;
                    document.getElementById('natural_time_sun').hidden = true;
                    document.getElementById('natural_time_sunset').hidden = true;
                    document.getElementById('natural_time_stars').hidden = true;
                };
            {% elif '/NT6' in locale.DEFAULT_TIME_ZONE or '/NT13'  in locale.DEFAULT_TIME_ZONE or '/NT30' in locale.DEFAULT_TIME_ZONE %}
                if (time_passed < 360) {
                    time_passed = time_passed + 1080;
                } else {
                    time_passed = time_passed - 360;
                }

                if (time_passed < 60) {
                    document.getElementById('natural_time_sunrise').hidden = false;
                    document.getElementById('natural_time_sun').hidden = true;
                    document.getElementById('natural_time_sunset').hidden = true;
                    document.getElementById('natural_time_stars').hidden = true;
                } else if (time_passed < 660) {
                    document.getElementById('natural_time_sunrise').hidden = true;
                    document.getElementById('natural_time_sun').hidden = false;
                    document.getElementById('natural_time_sunset').hidden = true;
                    document.getElementById('natural_time_stars').hidden = true;
                } else if (time_passed < 750) {
                    document.getElementById('natural_time_sunrise').hidden = true;
                    document.getElementById('natural_time_sun').hidden = true;
                    document.getElementById('natural_time_sunset').hidden = false;
                    document.getElementById('natural_time_stars').hidden = true;
                } else if (time_passed < 1290) {
                    document.getElementById('natural_time_sunrise').hidden = true;
                    document.getElementById('natural_time_sun').hidden = true;
                    document.getElementById('natural_time_sunset').hidden = true;
                    document.getElementById('natural_time_stars').hidden = false;
                } else {
                    document.getElementById('natural_time_sunrise').hidden = false;
                    document.getElementById('natural_time_sun').hidden = true;
                    document.getElementById('natural_time_sunset').hidden = true;
                    document.getElementById('natural_time_stars').hidden = true;
                };
            {% else %}
                if (time_passed < 240) {
                    document.getElementById('natural_time_sunrise').hidden = true;
                    document.getElementById('natural_time_sun').hidden = true;
                    document.getElementById('natural_time_sunset').hidden = true;
                    document.getElementById('natural_time_stars').hidden = false;
                } else if (time_passed < 360) {
                    document.getElementById('natural_time_sunrise').hidden = false;
                    document.getElementById('natural_time_sun').hidden = true;
                    document.getElementById('natural_time_sunset').hidden = true;
                    document.getElementById('natural_time_stars').hidden = true;
                } else if (time_passed < 960) {
                    document.getElementById('natural_time_sunrise').hidden = true;
                    document.getElementById('natural_time_sun').hidden = false;
                    document.getElementById('natural_time_sunset').hidden = true;
                    document.getElementById('natural_time_stars').hidden = true;
                } else if (time_passed < 1110) {
                    document.getElementById('natural_time_sunrise').hidden = true;
                    document.getElementById('natural_time_sun').hidden = true;
                    document.getElementById('natural_time_sunset').hidden = false;
                    document.getElementById('natural_time_stars').hidden = true;
                } else {
                    document.getElementById('natural_time_sunrise').hidden = true;
                    document.getElementById('natural_time_sun').hidden = true;
                    document.getElementById('natural_time_sunset').hidden = true;
                    document.getElementById('natural_time_stars').hidden = false;
                };
            {% endif %}

            var proportion = (100 - (time_passed / 1440 * 100));

            if (proportion <= 10) {
                proportion = proportion + 3;
            };

            document.getElementById('natural_time_passed').style = 'width: ' + proportion.toString() + '%;';

            {% if locale.DIGITS %}
                iso_time_display = iso_time_display.replaceAll('0', '{{ locale.DIGITS[0] }}');
                iso_time_display = iso_time_display.replaceAll('1', '{{ locale.DIGITS[1] }}');
                iso_time_display = iso_time_display.replaceAll('2', '{{ locale.DIGITS[2] }}');
                iso_time_display = iso_time_display.replaceAll('3', '{{ locale.DIGITS[3] }}');
                iso_time_display = iso_time_display.replaceAll('4', '{{ locale.DIGITS[4] }}');
                iso_time_display = iso_time_display.replaceAll('5', '{{ locale.DIGITS[5] }}');
                iso_time_display = iso_time_display.replaceAll('6', '{{ locale.DIGITS[6] }}');
                iso_time_display = iso_time_display.replaceAll('7', '{{ locale.DIGITS[7] }}');
                iso_time_display = iso_time_display.replaceAll('8', '{{ locale.DIGITS[8] }}');
                iso_time_display = iso_time_display.replaceAll('9', '{{ locale.DIGITS[9] }}');
            {% endif %}

            {% if base == 14 %}
                if (document.getElementById('time_display')) {
                    document.getElementById('time_display').innerHTML = iso_time_display;
                };
            {% else %}
                if (document.getElementById('iso_time_display')) {
                    document.getElementById('iso_time_display').innerHTML = iso_time_display;
                };
            {% endif %}

            //
            // Reload page to update the date at midnight
            //
            if (hours_24 === '00' && minutes === '00') {
                location.reload();
            } else if (sec == '00') {
                //
                // Update weather info every 10 minutes
                //
                if (
                    (minutes == '00')
                    || (minutes == '10')
                    || (minutes == '20')
                    || (minutes == '30')
                    || (minutes == '40')
                    || (minutes == '50')
                ) {
                    update_weather();
                }
            };

            //
            // Update every 1 second
            //
            setTimeout(auto_refresh_iso_display, 1000);
        };
        auto_refresh_iso_display();

        {% if base == 10 or base == 100 %}
            async function auto_refresh_sezimal_time(){
                var seconds = new Date().getTime();

                seconds = (seconds + ({{date.time._time_zone_offset.decimal}}  * 50000 / 27)) / 1000 / 86400;
                seconds = seconds - Math.floor(seconds);

                {% if '!' in format_token %}
                    const PAIRS = {
                        '00': '󱸀󱸀', '01': '󱸀󱸁', '02': '󱸀󱸂', '03': '󱸀󱸃', '04': '󱸀󱸄', '05': '󱸀󱸅',
                        '10': '󱸁󱸀', '11': '󱸁󱸁', '12': '󱸁󱸂', '13': '󱸁󱸃', '14': '󱸁󱸄', '15': '󱸁󱸅',
                        '20': '󱸂󱸀', '21': '󱸂󱸁', '22': '󱸂󱸂', '23': '󱸂󱸃', '24': '󱸂󱸄', '25': '󱸂󱸅',
                        '30': '󱸃󱸀', '31': '󱸃󱸁', '32': '󱸃󱸂', '33': '󱸃󱸃', '34': '󱸃󱸄', '35': '󱸃󱸅',
                        '40': '󱸄󱸀', '41': '󱸄󱸁', '42': '󱸄󱸂', '43': '󱸄󱸃', '44': '󱸄󱸄', '45': '󱸄󱸅',
                        '50': '󱸅󱸀', '51': '󱸅󱸁', '52': '󱸅󱸂', '53': '󱸅󱸃', '54': '󱸅󱸄', '55': '󱸅󱸅',
                    };
                {% elif format_token == '@' %}
                    const PAIRS = {
                        '00': '0', '01': '1', '02': '2', '03': '3', '04': '4', '05': '5',
                        '10': '0̇', '11': '1̇', '12': '2̇', '13': '3̇', '14': '4̇', '15': '5̇',
                        '20': '0̈', '21': '1̈', '22': '2̈', '23': '3̈', '24': '4̈', '25': '5̈',
                        '30': '0̊', '31': '1̊', '32': '2̊', '33': '3̊', '34': '4̊', '35': '5̊',
                        '40': '0̄', '41': '1̄', '42': '2̄', '43': '3̄', '44': '4̄', '45': '5̄',
                        '50': '0̆', '51': '1̆', '52': '2̆', '53': '3̆', '54': '4̆', '55': '5̆',
                    };
                {% elif format_token == '@!' %}
                    const PAIRS = {
                        '00': '󱸀', '01': '󱸁', '02': '󱸂', '03': '󱸃', '04': '󱸄', '05': '󱸅',
                        '10': '󱸆', '11': '󱸇', '12': '󱸈', '13': '󱸉', '14': '󱸊', '15': '󱸋',
                        '20': '󱸌', '21': '󱸍', '22': '󱸎', '23': '󱸏', '24': '󱸐', '25': '󱸑',
                        '30': '󱸒', '31': '󱸓', '32': '󱸔', '33': '󱸕', '34': '󱸖', '35': '󱸗',
                        '40': '󱸘', '41': '󱸙', '42': '󱸚', '43': '󱸛', '44': '󱸜', '45': '󱸝',
                        '50': '󱸞', '51': '󱸟', '52': '󱸠', '53': '󱸡', '54': '󱸢', '55': '󱸣',
                    };
                {% elif format_token == 'Z' %}
                    const PAIRS = {
                        '00': '0', '01': '1', '02': '2', '03': '3', '04': '4', '05': '5',
                        '10': '6', '11': '7', '12': '8', '13': '9', '14': 'A', '15': 'B',
                        '20': 'C', '21': 'D', '22': 'E', '23': 'F', '24': 'G', '25': 'H',
                        '30': 'I', '31': 'J', '32': 'K', '33': 'L', '34': 'M', '35': 'N',
                        '40': 'O', '41': 'P', '42': 'Q', '43': 'R', '44': 'S', '45': 'T',
                        '50': 'U', '51': 'V', '52': 'W', '53': 'X', '54': 'Y', '55': 'Z',
                    };
                {% endif %}

                var time = Math.floor(seconds * 36 * 36 * 36).toString(6).padStart(6, '0');
                var uta = time.slice(0, 2);
                var posha = time.slice(2, 4);
                var agrima = time.slice(4, 6);

                {% if format_token in ('!', '@', '@!', 'Z', 'c!') %}
                    {% if locale.show_seconds %}
                        time_display = PAIRS[uta] + '{{ time_separator }}' + PAIRS[posha] + '{{ time_separator }}' + PAIRS[agrima];
                    {% else %}
                        time_display = PAIRS[uta] + '{{ time_separator }}' + PAIRS[posha];
                    {% endif %}
                {% else %}
                    {% if locale.show_seconds %}
                        time_display = uta + '{{ time_separator }}' + posha + '{{ time_separator }}' + agrima;
                    {% else %}
                        time_display = uta + '{{ time_separator }}' + posha;
                    {% endif %}
                {% endif %}

                {% if locale.RTL %}
                    time_display = '\u{2066}' + time_display + '\u{2069}';
                {% endif %}

                {% if (base == 10) and ('!' not in format_token) and locale.DIGITS %}
                    time_display = time_display.replaceAll('0', '{{ locale.DIGITS[0] }}');
                    time_display = time_display.replaceAll('1', '{{ locale.DIGITS[1] }}');
                    time_display = time_display.replaceAll('2', '{{ locale.DIGITS[2] }}');
                    time_display = time_display.replaceAll('3', '{{ locale.DIGITS[3] }}');
                    time_display = time_display.replaceAll('4', '{{ locale.DIGITS[4] }}');
                    time_display = time_display.replaceAll('5', '{{ locale.DIGITS[5] }}');
                {% endif %}

                if (document.getElementById('time_display')) {
                    document.getElementById('time_display').innerHTML = time_display;
                };

                setTimeout(auto_refresh_sezimal_time, 1851.851851);
            };
            auto_refresh_sezimal_time();
        {% elif base == 20 %}
            async function auto_refresh_dozenal_time(){
                var seconds = new Date().getTime();

                seconds = (seconds + ({{date.time._time_zone_offset.decimal}}  * 50000 / 27)) / 1000 / 86400;
                seconds = seconds - Math.floor(seconds);

                var integer_time = seconds * 12 * 12 * 12;
                integer_time = Math.floor(integer_time);
                seconds = (seconds * 12 * 12 * 12) - integer_time;
                var dozenal_time = Math.floor(seconds * 12);

                {% if locale.show_seconds %}
                    time_display = integer_time.toString(12).padStart(3, '0')
                        + '{{ sezimal_separator }}'
                        + dozenal_time.toString(12).padStart(1, '0');
                {% else %}
                    time_display = integer_time.toString(12).padStart(3, '0');
                {% endif %}

                time_display = time_display.replaceAll('a', '↊').replaceAll('b', '↋');

                {% if locale.RTL %}
                    time_display = '\u{2066}' + time_display + '\u{2069}';
                {% endif %}

                if (document.getElementById('time_display')) {
                    document.getElementById('time_display').innerHTML = time_display;
                };

                setTimeout(auto_refresh_dozenal_time, 4166.666666);
            };
            auto_refresh_dozenal_time();
        {% endif %}

        let weather_open = false;

        function open_close_weather() {
            weather_open = !weather_open;

            if (weather_open) {
                document.getElementById('toggle_weather').innerText = '▴';
                document.getElementById('weather').style = 'display: inline;';
            } else {
                document.getElementById('toggle_weather').innerText = '▾';
                document.getElementById('weather').style = 'display: none;';
            };
        };

        update_weather();

        async function registerServiceWorker () {
            const swRegistration = await navigator.serviceWorker.register('/today/today_service.js'); //notice the file name
            return swRegistration;
        };

        async function requestNotificationPermission() {
            const permission = await window.Notification.requestPermission();
            return permission;
        };

        async function showLocalNotification(title, body, silent = true, alarm = false) {
            const swRegistration = await registerServiceWorker();
            const permission =  await requestNotificationPermission();

            if (permission != 'granted') {
                return;
            };

            let options = {
                body,
                icon: 'https://sezimal.tauga.online/now/icon-64.svg?{{ date.format('%Y%m%d%H%M%S') }}',
                silent: silent,
            };
            swRegistration.showNotification(title, options);
        };

        async function prepareForNotification () {
            await registerServiceWorker();
            await requestNotificationPermission();
{#
            await showLocalNotification(
                {% if locale.LANG == 'pt' %}
                'Esse é um teste do app “{{ TITLE }}”',
                {% elif locale.LANGUAGE_TAG in ('bz', 'en-BR', 'pt-BR') %}
                'Esi è un tèsti du app “{{ TITLE }}”',
                {% else %}
                'This is a test from the “{{ TITLE }}” app',
                {% endif %}

                {% if locale.LANG == 'pt' %}
                'Testando as notificações, como outros apps de alarme e tempo',
                {% elif locale.LANGUAGE_TAG in ('bz', 'en-BR', 'pt-BR') %}
                'Testandu as notifikasoyns, komu otrus apss di alarmi i tenpu',
                {% else %}
                'Testing notifications, like other alarm and weather apps',
                {% endif %}
            );
#}
        };

        prepareForNotification();

        var initialTouchX, initialTouchY, finalTouchX, finalTouchY;
        const swipeThreshold = 100;

        function handleTouch(startX, endX) {
            const horizontalDistance = finalTouchX - initialTouchX;
            const verticalDistance = finalTouchY - initialTouchY;

            if (
                (Math.abs(horizontalDistance) > Math.abs(verticalDistance))
                 && (Math.abs(horizontalDistance) > swipeThreshold)) {
                //
                // Swipe to the left:
                // Stopwatch -> Clock -> Timer
                //
                if (finalTouchX - initialTouchX < 0) {
                    if (!document.getElementById('stopwatch-content').hidden) {
                        document.getElementById('stopwatch-content').hidden = true;
                        document.getElementById('now-content').hidden = false;
                        document.getElementById('timer-content').hidden = true;
                    } else if (!document.getElementById('now-content').hidden) {
                        document.getElementById('stopwatch-content').hidden = true;
                        document.getElementById('now-content').hidden = true;
                        document.getElementById('timer-content').hidden = false;
                    } else if (!document.getElementById('timer-content').hidden) {
                        document.getElementById('stopwatch-content').hidden = false;
                        document.getElementById('now-content').hidden = true;
                        document.getElementById('timer-content').hidden = true;
                    };
                }
                //
                // Swipe to the right
                // Stopwatch <- Clock <- Timer
                //
                else {
                    if (!document.getElementById('timer-content').hidden) {
                        document.getElementById('stopwatch-content').hidden = true;
                        document.getElementById('now-content').hidden = false;
                        document.getElementById('timer-content').hidden = true;
                    } else if (!document.getElementById('now-content').hidden) {
                        document.getElementById('stopwatch-content').hidden = false;
                        document.getElementById('now-content').hidden = true;
                        document.getElementById('timer-content').hidden = true;
                    } else if (!document.getElementById('stopwatch-content').hidden) {
                        document.getElementById('stopwatch-content').hidden = true;
                        document.getElementById('now-content').hidden = true;
                        document.getElementById('timer-content').hidden = false;
                    };
                }
            }
        };

        window.onload = function () {
            window.addEventListener(
                'touchstart',
                function (event) {
                    initialTouchX = event.touches[0].clientX;
                    initialTouchY = event.touches[0].clientY;
                }
            );

            window.addEventListener(
                'touchend',
                function (event) {
                    finalTouchX = event.changedTouches[0].clientX;
                    finalTouchY = event.changedTouches[0].clientY;
                    handleTouch(initialTouchX, finalTouchX);
                }
            );
        };

        var stopwatch_start_time = null;
        var stopwatch_paused_time = null;
        var stopwatch_discount_time = 0;
        var stopwatch_timeout = null;

        function stopwatch_update() {
            if (stopwatch_start_time == null) {
                stopwatch_start_time = Date.now();
            }

            var seconds_passed = (Date.now() - stopwatch_start_time - stopwatch_discount_time) / 1000;
            var seconds = seconds_passed;

            var hour = Math.floor(seconds / 60 / 60);
            seconds = seconds - (hour * 60 * 60);
            var minute = Math.floor(seconds / 60);
            seconds = seconds - (minute * 60);
            var second = Math.floor(seconds);
            seconds = seconds - second
            var centisecond = Math.floor(seconds * 100);

            var stopwatch_iso_display =
                hour.toString().padStart(2, '0') + '{{ locale.TIME_SEPARATOR }}' +
                minute.toString().padStart(2, '0') + '{{ locale.TIME_SEPARATOR }}' +
                second.toString().padStart(2, '0') + '{{ locale.SEZIMAL_SEPARATOR }}' +
                centisecond.toString().padStart(2, '0');

            {% if locale.base == 10 %}
                var days = seconds_passed / 86400;

                var uta = Math.floor(days * 36);
                days = (days * 36) - uta;
                var posha = Math.floor(days * 36);
                days = (days * 36) - posha;
                var agrima = Math.floor(days * 36);
                days = (days * 36) - agrima;
                var anuga = Math.floor(days * 36);

                var stopwatch_display =
                    uta.toString(6).padStart(2, '0') + '{{ time_separator }}' +
                    posha.toString(6).padStart(2, '0') + '{{ time_separator }}' +
                    agrima.toString(6).padStart(2, '0') + '{{ sezimal_separator }}' +
                    anuga.toString(6).padStart(2, '0');

                {% if '!' in locale.format_token %}
                    stopwatch_display = stopwatch_display.
                        replaceAll('0', '󱸀').
                        replaceAll('1', '󱸁').
                        replaceAll('2', '󱸂').
                        replaceAll('3', '󱸃').
                        replaceAll('4', '󱸄').
                        replaceAll('5', '󱸅').
                        replaceAll('&#8󱸂󱸀󱸀;', '&#8200;');
                {% endif %}

            {% elif locale.base == 20 %}
                var days = seconds_passed / 86400;

                var integer_time = Math.floor(days * 12 * 12 * 12);
                days = (days * 12 * 12 * 12) - integer_time;
                var fraction_time = Math.floor(days * 12 * 12 * 12);

                var stopwatch_display =
                    integer_time.toString(12).padStart(3, '0') + '{{ locale.SEZIMAL_SEPARATOR }}' +
                    fraction_time.toString(12).padStart(3, '0');

                stopwatch_display = stopwatch_display.replaceAll('a', '↊').replaceAll('b', '↋');
            {% else %}
                var stopwatch_display = stopwatch_iso_display;
            {% endif %}

            document.getElementById('stopwatch_display').innerHTML = stopwatch_display;
            document.getElementById('stopwatch_iso_display').innerHTML = stopwatch_iso_display;

            stopwatch_timeout = setTimeout(stopwatch_update, 1);
        }

        function stopwatch_start() {
            if (stopwatch_start_time == null) {
                stopwatch_start_time = Date.now();
            } else if (stopwatch_paused_time !== null) {
                stopwatch_discount_time += Date.now() - stopwatch_paused_time;
            }

            stopwatch_paused_time = null;

            document.getElementById('stopwatch_play').hidden = true;
            document.getElementById('stopwatch_pause').hidden = false;
            document.getElementById('stopwatch_reset').hidden = true;

            stopwatch_update();
        };

        function stopwatch_reset() {
            stopwatch_start_time = null;
            stopwatch_paused_time = null;
            stopwatch_discount_time = 0;
            clearTimeout(stopwatch_timeout);

            document.getElementById('stopwatch_play').hidden = false;
            document.getElementById('stopwatch_pause').hidden = true;
            document.getElementById('stopwatch_reset').hidden = true;

            {% if locale.base == 10 %}
                {% if '!' in locale.format_token %}
                    document.getElementById('stopwatch_display').innerHTML = '󱸀󱸀{{ time_separator }}󱸀󱸀{{ time_separator }}󱸀󱸀{{ sezimal_separator }}󱸀󱸀';
                {% else %}
                    document.getElementById('stopwatch_display').innerHTML = '00{{ time_separator }}00{{ time_separator }}00{{ sezimal_separator }}00';
                {% endif %}
            {% else %}
                document.getElementById('stopwatch_display').innerHTML = '000{{ locale.SEZIMAL_SEPARATOR }}00';
            {% endif %}
            document.getElementById('stopwatch_iso_display').innerHTML = '00{{ locale.TIME_SEPARATOR }}00{{ locale.TIME_SEPARATOR }}00{{ locale.SEZIMAL_SEPARATOR }}00';
        }

        function stopwatch_pause() {
            stopwatch_paused_time = Date.now();
            clearTimeout(stopwatch_timeout);

            document.getElementById('stopwatch_play').hidden = false;
            document.getElementById('stopwatch_pause').hidden = true;

            if (stopwatch_start_time == null) {
                document.getElementById('stopwatch_reset').hidden = true;
            } else {
                document.getElementById('stopwatch_reset').hidden = false;
            };
        }

        var timer_time_uta = 0;
        var timer_time_posha = 0;
        var timer_time_agrima = 0;
        var timer_time_anuga = 0;
        var timer_time_boda = 0;
        var timer_time_ekatiboda = 0;

        var timer_time_set_seconds = 0;
        var timer_start_time = null;
        var timer_paused_time = null;
        var timer_discount_time = 0;
        var timer_timeout = null;
        var timer_music_playing = false;

        function set_timer() {
            {% if locale.base == 10 %}
                var timer_time_display = '&#8200;' +
                    timer_time_uta.toString(6).padStart(2, '0') + '{{ time_separator }}' +
                    timer_time_posha.toString(6).padStart(2, '0') + '{{ time_separator }}' +
                    timer_time_agrima.toString(6).padStart(2, '0') + '{{ sezimal_separator }}' +
                    timer_time_anuga.toString(6).padStart(2, '0');

                {% if '!' in locale.format_token %}
                    timer_time_display = timer_time_display.
                        replaceAll('0', '󱸀').
                        replaceAll('1', '󱸁').
                        replaceAll('2', '󱸂').
                        replaceAll('3', '󱸃').
                        replaceAll('4', '󱸄').
                        replaceAll('5', '󱸅').
                        replaceAll('&#8󱸂󱸀󱸀;', '&#8200;');
                {% endif %}

                var anuga =
                    timer_time_uta * 36 * 36 * 36 +
                    timer_time_posha * 36 * 36 +
                    timer_time_agrima * 36 +
                    timer_time_anuga;

                timer_time_set_seconds = anuga * 25 / 486;

                var hour = Math.floor(anuga / 69984);
                anuga = anuga - (hour * 69984);
                var minute = Math.floor(anuga * 5 / 5832);
                anuga = anuga - (minute / 5 * 5832);
                var second = Math.floor(anuga * 25 / 486);
                anuga = anuga - (second / 25 * 486);
                var centisecond = Math.floor(anuga * 1250 / 243);

            {% elif locale.base == 20 %}
                var timer_time_display = '&#8200;' +
                    timer_time_uta.toString(12).padStart(1, '0') +
                    timer_time_posha.toString(12).padStart(1, '0') +
                    timer_time_agrima.toString(12).padStart(1, '0') + '{{ sezimal_separator }}' +
                    timer_time_anuga.toString(12).padStart(1, '0') +
                    timer_time_boda.toString(12).padStart(1, '0') +
                    timer_time_ekatiboda.toString(12).padStart(1, '0');

                timer_time_display = timer_time_display.replaceAll('a', '↊').replaceAll('b', '↋');

                var anuga =
                    timer_time_uta * 12 * 12 * 12 +
                    timer_time_posha * 12 * 12 +
                    timer_time_agrima * 12 +
                    timer_time_anuga +
                    timer_time_boda / 12 +
                    timer_time_ekatiboda / 12 / 12;

                timer_time_set_seconds = anuga * 25 / 6;

                var hour = Math.floor(anuga / 864);
                anuga = anuga - (hour * 864);
                var minute = Math.floor(anuga * 10 / 144);
                anuga = anuga - (minute * 144 / 10);
                var second = Math.floor(anuga * 600 / 144);
                anuga = anuga - (second * 144 / 600);
                var centisecond = Math.floor(anuga * 1250 / 3);
            {% else %}
            {% endif %}

            var timer_iso_display = '&#8200;' +
                hour.toString().padStart(2, '0') + ':' +
                minute.toString().padStart(2, '0') + ':' +
                second.toString().padStart(2, '0') + '{{ sezimal_separator }}' +
                centisecond.toString().padStart(2, '0');

            document.getElementById('timer_display').innerHTML = timer_time_display;
            document.getElementById('timer_iso_display').innerHTML = timer_iso_display;
        }

        function timer_uta(sign='+') {
            if (sign == '+') {
                timer_time_uta += 1;

                {% if locale.base == 10 %}
                    if (timer_time_uta >= 36) {
                        timer_time_uta = 0;
                    }
                {% elif locale.base == 20 %}
                    if (timer_time_uta >= 12) {
                        timer_time_uta = 0;
                    }
                {% else %}
                    if (timer_time_uta >= 24) {
                        timer_time_uta = 0;
                    }
                {% endif %}
            } else {
                timer_time_uta -= 1;
                {% if locale.base == 10 %}
                    if (timer_time_uta < 0) {
                        timer_time_uta = 35;
                    }
                {% elif locale.base == 20 %}
                    if (timer_time_uta < 0) {
                        timer_time_uta = 11;
                    }
                {% else %}
                    if (timer_time_uta < 0) {
                        timer_time_uta = 23;
                    }
                {% endif %}
            }

            set_timer();
        };

        function timer_posha(sign='+') {
            if (sign == '+') {
                timer_time_posha += 1;

                {% if locale.base == 10 %}
                    if (timer_time_posha >= 36) {
                        timer_time_posha = 0;
                    }
                {% elif locale.base == 20 %}
                    if (timer_time_posha >= 12) {
                        timer_time_posha = 0;
                    }
                {% else %}
                    if (timer_time_posha >= 60) {
                        timer_time_posha = 0;
                    }
                {% endif %}
            } else {
                timer_time_posha -= 1;
                {% if locale.base == 10 %}
                    if (timer_time_posha < 0) {
                        timer_time_posha = 35;
                    }
                {% elif locale.base == 20 %}
                    if (timer_time_posha < 0) {
                        timer_time_posha = 11;
                    }
                {% else %}
                    if (timer_time_posha < 0) {
                        timer_time_posha = 59;
                    }
                {% endif %}
            }

            set_timer();
        };

        function timer_agrima(sign='+') {
            if (sign == '+') {
                timer_time_agrima += 1;

                {% if locale.base == 10 %}
                    if (timer_time_agrima >= 36) {
                        timer_time_agrima = 0;
                    }
                {% elif locale.base == 20 %}
                    if (timer_time_agrima >= 12) {
                        timer_time_agrima = 0;
                    }
                {% else %}
                    if (timer_time_agrima >= 60) {
                        timer_time_agrima = 0;
                    }
                {% endif %}
            } else {
                timer_time_agrima -= 1;
                {% if locale.base == 10 %}
                    if (timer_time_agrima < 0) {
                        timer_time_agrima = 35;
                    }
                {% elif locale.base == 20 %}
                    if (timer_time_agrima < 0) {
                        timer_time_agrima = 11;
                    }
                {% else %}
                    if (timer_time_agrima < 0) {
                        timer_time_agrima = 59;
                    }
                {% endif %}
            }

            set_timer();
        };

        function timer_anuga(sign='+') {
            if (sign == '+') {
                timer_time_anuga += 1;

                {% if locale.base == 10 %}
                    if (timer_time_anuga >= 36) {
                        timer_time_anuga = 0;
                    }
                {% elif locale.base == 20 %}
                    if (timer_time_anuga >= 12) {
                        timer_time_anuga = 0;
                    }
                {% else %}
                    if (timer_time_anuga >= 60) {
                        timer_time_anuga = 0;
                    }
                {% endif %}
            } else {
                timer_time_anuga -= 1;
                {% if locale.base == 10 %}
                    if (timer_time_anuga < 0) {
                        timer_time_anuga = 35;
                    }
                {% elif locale.base == 20 %}
                    if (timer_time_anuga < 0) {
                        timer_time_anuga = 11;
                    }
                {% else %}
                    if (timer_time_anuga < 0) {
                        timer_time_anuga = 59;
                    }
                {% endif %}
            }

            set_timer();
        };

        function timer_boda(sign='+') {
            if (sign == '+') {
                timer_time_boda += 1;

                {% if locale.base == 10 %}
                    if (timer_time_boda >= 36) {
                        timer_time_boda = 0;
                    }
                {% elif locale.base == 20 %}
                    if (timer_time_boda >= 12) {
                        timer_time_boda = 0;
                    }
                {% else %}
                    if (timer_time_boda >= 60) {
                        timer_time_boda = 0;
                    }
                {% endif %}
            } else {
                timer_time_boda -= 1;
                {% if locale.base == 10 %}
                    if (timer_time_boda < 0) {
                        timer_time_boda = 35;
                    }
                {% elif locale.base == 20 %}
                    if (timer_time_boda < 0) {
                        timer_time_boda = 11;
                    }
                {% else %}
                    if (timer_time_boda < 0) {
                        timer_time_boda = 59;
                    }
                {% endif %}
            }

            set_timer();
        };

        function timer_ekatiboda(sign='+') {
            if (sign == '+') {
                timer_time_ekatiboda += 1;

                {% if locale.base == 10 %}
                    if (timer_time_ekatiboda >= 36) {
                        timer_time_ekatiboda = 0;
                    }
                {% elif locale.base == 20 %}
                    if (timer_time_ekatiboda >= 12) {
                        timer_time_ekatiboda = 0;
                    }
                {% else %}
                    if (timer_time_ekatiboda >= 60) {
                        timer_time_ekatiboda = 0;
                    }
                {% endif %}
            } else {
                timer_time_ekatiboda -= 1;
                {% if locale.base == 10 %}
                    if (timer_time_ekatiboda < 0) {
                        timer_time_ekatiboda = 35;
                    }
                {% elif locale.base == 20 %}
                    if (timer_time_ekatiboda < 0) {
                        timer_time_ekatiboda = 11;
                    }
                {% else %}
                    if (timer_time_ekatiboda < 0) {
                        timer_time_ekatiboda = 59;
                    }
                {% endif %}
            }

            set_timer();
        };

        function timer_update() {
            if (timer_start_time == null) {
                timer_start_time = Date.now();
            }

            var seconds_passed = timer_time_set_seconds - ((Date.now() - timer_start_time - timer_discount_time) / 1000);

            var sign = '&#8200;';
            var sign_iso = '&#8200;';

            if (seconds_passed < 0) {
                sign = '−';
                sign_iso = '−';
                seconds_passed = seconds_passed * -1;
            }

            var seconds = Math.abs(seconds_passed);

            var hour = Math.floor(seconds / 60 / 60);
            seconds = seconds - (hour * 60 * 60);
            var minute = Math.floor(seconds / 60);
            seconds = seconds - (minute * 60);
            var second = Math.floor(seconds);
            seconds = seconds - second;
            var centisecond = Math.floor(seconds * 100);

            if ((hour == 0) && (minute == 0) && (second == 0) && (centisecond == 0)) {
                sign_iso = '&#8200;';
            };

            var timer_iso_display = sign_iso +
                hour.toString().padStart(2, '0') + '{{ locale.TIME_SEPARATOR }}' +
                minute.toString().padStart(2, '0') + '{{ locale.TIME_SEPARATOR }}' +
                second.toString().padStart(2, '0') + '{{ locale.SEZIMAL_SEPARATOR }}' +
                centisecond.toString().padStart(2, '0');

            {% if locale.base == 10 %}
                var days = seconds_passed / 86400;

                var uta = Math.floor(days * 36);
                days = (days * 36) - uta;
                var posha = Math.floor(days * 36);
                days = (days * 36) - posha;
                var agrima = Math.floor(days * 36);
                days = (days * 36) - agrima;
                var anuga = Math.floor(days * 36);

                if ((uta == 0) && (posha == 0) && (agrima == 0) && (anuga == 0)) {
                    sign = '&#8200;';
                };

                var timer_display = sign +
                    uta.toString(6).padStart(2, '0') + '{{ time_separator }}' +
                    posha.toString(6).padStart(2, '0') + '{{ time_separator }}' +
                    agrima.toString(6).padStart(2, '0') + '{{ sezimal_separator }}' +
                    anuga.toString(6).padStart(2, '0');

                {% if '!' in locale.format_token %}
                    timer_display = timer_display.
                        replaceAll('0', '󱸀').
                        replaceAll('1', '󱸁').
                        replaceAll('2', '󱸂').
                        replaceAll('3', '󱸃').
                        replaceAll('4', '󱸄').
                        replaceAll('5', '󱸅').
                        replaceAll('&#8󱸂󱸀󱸀;', '&#8200;');
                {% endif %}

            {% elif locale.base == 20 %}
                var days = seconds_passed / 86400;
                var dias = days;

                var integer_time = Math.floor(days * 12 * 12 * 12);
                days = (days * 12 * 12 * 12) - integer_time;
                var fraction_time = Math.floor(days * 12 * 12 * 12);

                if ((integer_time == 0) && (fraction_time == 0)) {
                    sign = '&#8200;';
                };

                var timer_display = sign +
                    integer_time.toString(12).padStart(3, '0') + '{{ sezimal_separator }}' +
                    fraction_time.toString(12).padStart(3, '0');

                timer_display = timer_display.replaceAll('a', '↊').replaceAll('b', '↋');

            {% else %}
                var timer_display = timer_iso_display;
            {% endif %}

            if (
                (
                    (timer_time_uta != 0)
                    || (timer_time_posha != 0)
                    || (timer_time_agrima != 0)
                    || (timer_time_anuga != 0)
                    || (timer_time_boda != 0)
                    || (timer_time_ekatiboda != 0)
                ) && (sign == '−') && (!timer_music_playing)
            ) {
                timer_music_playing = true;
                document.getElementById('audio').play();
            }

            document.getElementById('timer_display').innerHTML = timer_display;
            document.getElementById('timer_iso_display').innerHTML = timer_iso_display;

            timer_timeout = setTimeout(timer_update, 1);
        }

        function timer_start() {
            if (timer_start_time == null) {
                timer_start_time = Date.now();
            } else if (timer_paused_time !== null) {
                timer_discount_time += Date.now() - timer_paused_time;
            }

            timer_paused_time = null;

            document.getElementById('timer_play').hidden = true;
            document.getElementById('timer_pause').hidden = false;
            document.getElementById('timer_reset').hidden = true;
            document.getElementById('timer_add').hidden = true;
            document.getElementById('timer_subtract').hidden = true;

            timer_update();
        };

        function timer_reset() {
            timer_start_time = null;
            timer_paused_time = null;
            timer_discount_time = 0;
            timer_time_uta = 0;
            timer_time_posha = 0;
            timer_time_agrima = 0;
            timer_time_anuga = 0;
            timer_time_boda = 0;
            timer_time_ekatiboda = 0;
            timer_time_set_seconds = 0;
            clearTimeout(timer_timeout);

            document.getElementById('timer_play').hidden = false;
            document.getElementById('timer_pause').hidden = true;
            document.getElementById('timer_reset').hidden = true;
            document.getElementById('timer_add').hidden = false;
            document.getElementById('timer_subtract').hidden = false;

            if (timer_music_playing) {
                timer_music_playing = false;
                document.getElementById('audio').pause();
            }

            {% if locale.base == 10 %}
                {% if '!' in locale.format_token %}
                    document.getElementById('timer_display').innerHTML = '&#8200;󱸀󱸀{{ time_separator }}󱸀󱸀{{ time_separator }}󱸀󱸀{{ sezimal_separator }}󱸀󱸀';
                {% else %}
                    document.getElementById('timer_display').innerHTML = '&#8200;00{{ time_separator }}00{{ time_separator }}00{{ sezimal_separator }}00';
                {% endif %}
            {% else %}
                document.getElementById('timer_display').innerHTML = '&#8200;000{{ sezimal_separator }}000';
            {% endif %}
            document.getElementById('timer_iso_display').innerHTML = '&#8200;00:00:00{{ sezimal_separator }}00';
        }

        function timer_pause() {
            timer_paused_time = Date.now();
            clearTimeout(timer_timeout);

            if (timer_music_playing) {
                timer_music_playing = false;
                document.getElementById('audio').pause();
            }

            document.getElementById('timer_play').hidden = false;
            document.getElementById('timer_pause').hidden = true;

            if (timer_start_time == null) {
                document.getElementById('timer_reset').hidden = true;
            } else {
                document.getElementById('timer_reset').hidden = false;
            };
        }

        const browser_is_touchable = 'ontouchstart' in window ||
            (window.DocumentTouch && document instanceof window.DocumentTouch) ||
            navigator.maxTouchPoints > 0 ||
            window.navigator.msMaxTouchPoints > 0;

        if (!browser_is_touchable) {
            document.getElementById('show_stopwath').hidden = false;
            document.getElementById('show_timer').hidden = false;
        }

        function show_stopwath() {
            document.getElementById('show_stopwath').hidden = true;
            document.getElementById('show_clock_stopwatch').hidden = false;
            document.getElementById('show_clock_timer').hidden = true;
            document.getElementById('show_timer').hidden = true;

            document.getElementById('stopwatch-content').hidden = false;
            document.getElementById('now-content').hidden = true;
            document.getElementById('timer-content').hidden = true;
        }

        function show_clock() {
            document.getElementById('show_stopwath').hidden = false;
            document.getElementById('show_clock_stopwatch').hidden = true;
            document.getElementById('show_clock_timer').hidden = true;
            document.getElementById('show_timer').hidden = false;

            document.getElementById('stopwatch-content').hidden = true;
            document.getElementById('now-content').hidden = false;
            document.getElementById('timer-content').hidden = true;
        }

        function show_timer() {
            document.getElementById('show_stopwath').hidden = true;
            document.getElementById('show_clock_stopwatch').hidden = true;
            document.getElementById('show_clock_timer').hidden = false;
            document.getElementById('show_timer').hidden = true;

            document.getElementById('stopwatch-content').hidden = true;
            document.getElementById('now-content').hidden = true;
            document.getElementById('timer-content').hidden = false;
        }
    </script>
</html>
