
{%- set WEEKDAYS = SezimalList([0, 1, 2, 3, 4, 5, 6]) -%}
{%- set WEEKDAY_BORDER_LEFT = 5 -%}
{%- set WEEKDAY_BORDER_RIGHT = -1 -%}
{%- set DAYS_IN_WEEK = 11 -%}
{%- set SHADES = SezimalList([shade_01, shade_02, shade_03, shade_04, shade_05, shade_10, shade_11]) -%}
{%- set BACK_SHADES = SezimalList([back_shade_01, back_shade_02, back_shade_03, back_shade_04, back_shade_05, back_shade_10, back_shade_11]) -%}
{%- set TEXT_SHADES = SezimalList([text_shade_01, text_shade_02, text_shade_03, text_shade_04, text_shade_05, text_shade_10, text_shade_11]) -%}

{%- set USE_LOCALE_FIRST_WEEKDAY = (getattr(locale, 'use_first_weekday', False) and locale.FIRST_WEEKDAY != 'MON') -%}

{%- if USE_LOCALE_FIRST_WEEKDAY -%}
    {%- if locale.FIRST_WEEKDAY == 'SUN' -%}
        {%- set WEEKDAYS = SezimalList([6, 0, 1, 2, 3, 4, 5]) -%}

        {# This is for most countries where the week starts on Sunday #}
        {%- if locale.DAY_OF_REST == 'SUN' -%}
            {%- set WEEKDAY_BORDER_RIGHT = 6 -%}

            {%- if locale.OPTIONAL_DAY_OF_REST == 'SAT' -%}
                {%- set WEEKDAY_BORDER_LEFT = 5 -%}
            {%- endif -%}

        {# This is Hebrew and Arabic #}
        {%- elif locale.DAY_OF_REST == 'SAT' -%}
            {%- if locale.OPTIONAL_DAY_OF_REST == 'FRI' -%}
                {%- set WEEKDAY_BORDER_LEFT = 4 -%}
                {%- set WEEKDAY_BORDER_RIGHT = -1 -%}
            {%- else -%}
                {%- set WEEKDAY_BORDER_LEFT = 5 -%}
            {%- endif -%}
        {%- endif -%}

    {# This is basically just Iran #}
    {%- elif locale.FIRST_WEEKDAY == 'SAT' -%}
        {%- set WEEKDAYS = SezimalList([5, 6, 0, 1, 2, 3, 4]) -%}
        {%- set WEEKDAY_BORDER_LEFT = 4 -%}
        {%- set WEEKDAY_BORDER_RIGHT = -1 -%}
    {%- endif -%}
{%- endif -%}

{%- if base == 14 -%}
    {%- set UTAS = SezimalDictionary({0: '00', 1: '01', 2: '02', 3: '03', 4: '04', 5: '05', 10: '06', 11: '07', 12: '08', 13: '09', 14: '10', 15: '11', 20: '12', 21: '13', 22: '14', 23: '15', 24: '16', 25: '17', 30: '18', 31: '19', 32: '20', 33: '21', 34: '22', 35: '23'}) -%}
    {%- set HOURS_24 = SezimalDictionary({0: '00', 1: '01', 2: '02', 3: '03', 4: '04', 5: '05', 10: '06', 11: '07', 12: '08', 13: '09', 14: '10', 15: '11', 20: '12', 21: '13', 22: '14', 23: '15', 24: '16', 25: '17', 30: '18', 31: '19', 32: '20', 33: '21', 34: '22', 35: '23'}) -%}
    {%- set HALF = '30' -%}
    {%- set SEPARATOR = locale.TIME_SEPARATOR -%}
    {%- set MIDDAY = 20 -%}

    {%- if locale.HOUR_FORMAT == '12h' -%}
        {%- set UTAS = SezimalDictionary({0: '0', 1: '1', 2: '2', 3: '3', 4: '4', 5: '5', 10: '6', 11: '7', 12: '8', 13: '9', 14: '10', 15: '11', 20: '12', 21: '1', 22: '2', 23: '3', 24: '4', 25: '5', 30: '6', 31: '7', 32: '8', 33: '9', 34: '10', 35: '11'}) -%}
    {%- endif -%}
{%- elif base == 20 -%}
    {%- set UTAS = SezimalDictionary({0: '00', 1: '03', 2: '06', 3: '09', 4: '10', 5: '13', 10: '16', 11: '19', 12: '20', 13: '23', 14: '26', 15: '29', 20: '30', 21: '33', 22: '36', 23: '39', 24: '40', 25: '43', 30: '46', 31: '49', 32: '50', 33: '53', 34: '56', 35: '59', 40: '60', 41: '63', 42: '66', 43: '69', 44: '70', 45: '73', 50: '76', 51: '79', 52: '80', 53: '83', 54: '86', 55: '89', 100: '90', 101: '93', 102: '96', 103: '99', 104: '↊0', 105: '↊3', 110: '↊6', 111: '↊9', 112: '↋0', 113: '↋3', 114: '↋6', 115: '↋9'}) -%}
    {%- set HOURS_24 = SezimalDictionary({0: '00', 1: '03', 2: '06', 3: '09', 4: '10', 5: '13', 10: '16', 11: '19', 12: '20', 13: '23', 14: '26', 15: '29', 20: '30', 21: '33', 22: '36', 23: '39', 24: '40', 25: '43', 30: '46', 31: '49', 32: '50', 33: '53', 34: '56', 35: '59', 40: '60', 41: '63', 42: '66', 43: '69', 44: '70', 45: '73', 50: '76', 51: '79', 52: '80', 53: '83', 54: '86', 55: '89', 100: '90', 101: '93', 102: '96', 103: '99', 104: '↊0', 105: '↊3', 110: '↊6', 111: '↊9', 112: '↋0', 113: '↋3', 114: '↋6', 115: '↋9'}) -%}
    {%- set HALF = '6' -%}
    {%- set SEPARATOR = '' -%}
    {%- set MIDDAY = 40 -%}
{%- elif base == 100 -%}
    {%- set UTAS = SezimalDictionary({0: '0', 1: '1', 2: '2', 3: '3', 4: '4', 5: '5', 10: '0̇', 11: '1̇', 12: '2̇', 13: '3̇', 14: '4̇', 15: '5̇', 20: '0̈', 21: '1̈', 22: '2̈', 23: '3̈', 24: '4̈', 25: '5̈', 30: '0̊', 31: '1̊', 32: '2̊', 33: '3̊', 34: '4̊', 35: '5̊', 40: '0̄', 41: '1̄', 42: '2̄', 43: '3̄', 44: '4̄', 45: '5̄', 50: '0̆', 51: '1̆', 52: '2̆', 53: '3̆', 54: '4̆', 55: '5̆'}) -%}
    {%- set HOURS_24 = SezimalDictionary({0: '00', 1: '01', 2: '02', 3: '03', 4: '04', 5: '05', 10: '10', 11: '11', 12: '12', 13: '13', 14: '14', 15: '15', 20: '20', 21: '21', 22: '22', 23: '23', 24: '24', 25: '25', 30: '30', 31: '31', 32: '32', 33: '33', 34: '34', 35: '35', 40: '40', 41: '41', 42: '42', 43: '43', 44: '44', 45: '45', 50: '50', 51: '51', 52: '52', 53: '53', 54: '54', 55: '55'}) -%}
    {%- set HALF = '0̊' -%}
    {%- set SEPARATOR = locale.TIME_SEPARATOR -%}
    {%- set MIDDAY = 30 -%}

    {%- if sezimal_digits or format_token == '@!' -%}
        {%- set UTAS = SezimalDictionary({0: '󱸀', 1: '󱸁', 2: '󱸂', 3: '󱸃', 4: '󱸄', 5: '󱸅', 10: '󱸆', 11: '󱸇', 12: '󱸈', 13: '󱸉', 14: '󱸊', 15: '󱸋', 20: '󱸌', 21: '󱸍', 22: '󱸎', 23: '󱸏', 24: '󱸐', 25: '󱸑', 30: '󱸒', 31: '󱸓', 32: '󱸔', 33: '󱸕', 34: '󱸖', 35: '󱸗', 40: '󱸘', 41: '󱸙', 42: '󱸚', 43: '󱸛', 44: '󱸜', 45: '󱸝', 50: '󱸞', 51: '󱸟', 52: '󱸠', 53: '󱸡', 54: '󱸢', 55: '󱸣'}) -%}
        {%- set HALF = '󱸒' -%}
        {%- set SEPARATOR = '󱹷' -%}
    {%- elif format_token == 'Z' -%}
        {%- set UTAS = SezimalDictionary({0: '0', 1: '1', 2: '2', 3: '3', 4: '4', 5: '5', 10: '6', 11: '7', 12: '8', 13: '9', 14: 'A', 15: 'B', 20: 'C', 21: 'D', 22: 'E', 23: 'F', 24: 'G', 25: 'H', 30: 'I', 31: 'J', 32: 'K', 33: 'L', 34: 'M', 35: 'N', 40: 'O', 41: 'P', 42: 'Q', 43: 'R', 44: 'S', 45: 'T', 50: 'U', 51: 'V', 52: 'W', 53: 'X', 54: 'Y', 55: 'Z'}) -%}
        {%- set HALF = 'I' -%}
        {%- set SEPARATOR = locale.TIME_SEPARATOR -%}
    {%- endif -%}
{%- else -%}
    {%- set UTAS = SezimalDictionary({0: '00', 1: '01', 2: '02', 3: '03', 4: '04', 5: '05', 10: '10', 11: '11', 12: '12', 13: '13', 14: '14', 15: '15', 20: '20', 21: '21', 22: '22', 23: '23', 24: '24', 25: '25', 30: '30', 31: '31', 32: '32', 33: '33', 34: '34', 35: '35', 40: '40', 41: '41', 42: '42', 43: '43', 44: '44', 45: '45', 50: '50', 51: '51', 52: '52', 53: '53', 54: '54', 55: '55'}) -%}
    {%- set HOURS_24 = SezimalDictionary({0: '00', 1: '01', 2: '02', 3: '03', 4: '04', 5: '05', 10: '10', 11: '11', 12: '12', 13: '13', 14: '14', 15: '15', 20: '20', 21: '21', 22: '22', 23: '23', 24: '24', 25: '25', 30: '30', 31: '31', 32: '32', 33: '33', 34: '34', 35: '35', 40: '40', 41: '41', 42: '42', 43: '43', 44: '44', 45: '45', 50: '50', 51: '51', 52: '52', 53: '53', 54: '54', 55: '55'}) -%}
    {%- set HALF = '30' -%}
    {%- set SEPARATOR = locale.TIME_SEPARATOR -%}
    {%- set MIDDAY = 30 -%}

    {%- if sezimal_digits or '!' in format_token -%}
        {%- set UTAS = SezimalDictionary({0: '󱸀󱸀', 1: '󱸀󱸁', 2: '󱸀󱸂', 3: '󱸀󱸃', 4: '󱸀󱸄', 5: '󱸀󱸅', 10: '󱸁󱸀', 11: '󱸁󱸁', 12: '󱸁󱸂', 13: '󱸁󱸃', 14: '󱸁󱸄', 15: '󱸁󱸅', 20: '󱸂󱸀', 21: '󱸂󱸁', 22: '󱸂󱸂', 23: '󱸂󱸃', 24: '󱸂󱸄', 25: '󱸂󱸅', 30: '󱸃󱸀', 31: '󱸃󱸁', 32: '󱸃󱸂', 33: '󱸃󱸃', 34: '󱸃󱸄', 35: '󱸃󱸅', 40: '󱸄󱸀', 41: '󱸄󱸁', 42: '󱸄󱸂', 43: '󱸄󱸃', 44: '󱸄󱸄', 45: '󱸄󱸅', 50: '󱸅󱸀', 51: '󱸅󱸁', 52: '󱸅󱸂', 53: '󱸅󱸃', 54: '󱸅󱸄', 55: '󱸅󱸅'}) -%}
        {%- set HALF = '󱸃󱸀' -%}
        {%- set SEPARATOR = '󱹷' -%}
    {%- endif -%}
{%- endif -%}
{%- set HALF_UTA_FONT_SIZE = '0.70rem' -%}

{%- if locale.DIGITS and (base in (10, 14)) and (format_token != '!') -%}
    {%- for i in UTAS -%}
        {%- set UTAS = UTAS.update({i: locale.digit_replace(UTAS[i])}) -%}
    {%- endfor -%}
    {%- set HALF = locale.digit_replace(HALF) -%}
{%- endif -%}

{%- set color_week_in_year = date.week_in_year -%}

{%- if locale.calendar_displayed == 'DCC' -%}
    {%- set WEEKDAY_BORDER_LEFT = 5 -%}
    {%- set WEEKDAY_BORDER_RIGHT = 0 -%}
    {%- set DAYS_IN_WEEK = 10 -%}
    {%- set WEEKDAYS = SezimalList([0, 1, 2, 3, 4, 5]) -%}
    {%- set color_week_in_year = date.dcc_week_in_year -%}
{%- endif -%}

<table class="center" style="border-spacing: 0px;" id="time_table">
    <colgroup>
        {%- if locale.calendar_displayed == 'DCC' -%}
            <col span="1" width="10%">
            <col span="1" width="15%">
            <col span="1" width="15%">
            <col span="1" width="15%">
            <col span="1" width="15%">
            <col span="1" width="15%">
            <col span="1" width="15%">
        {%- else -%}
            <col span="1" width="6%">
            <col span="1">
            <col span="1">
            <col span="1">
            <col span="1">
            <col span="1">
            <col span="1">
            <col span="1">
        {%- endif -%}
    </colgroup>
    {%- for uta in SezimalList(UTAS.keys())[uta_first:uta_last] -%}
        {%- set time_id = HOURS_24[uta] -%}
        {%- if base != 20 -%}
            <tr style="vertical-align: top; background-color: #111;" id="time_{{time_id}}">
                <td style="line-height: {{WEEK_LINE_HEIGHT}}; font-weight: bold; font-size: {{DATE_FONT_SIZE}}; color: {{colors[color_week_in_year]['100' if uta < MIDDAY else '300']}}; border-{{ 'left' if locale.RTL else 'right' }}: 1px solid {{colors[color_week_in_year][shade_week_number]}};">
                    {{ '\N{LRI}' }}{{UTAS[uta]}}{%- if base == 14 and locale.HOUR_FORMAT == '12h' -%}<span style="font-size: {{WEEK_FONT_SIZE}};" class="hide-in-mobile">{{ ' ' + (locale.lower(locale.AM) if uta < 20 else locale.lower(locale.PM)) }}</span>{%- endif -%}{{ '\N{PDI}' }}
                </td>
                {%- for i in SezimalRange(DAYS_IN_WEEK) -%}
                    <td style="line-height: {{WEEK_LINE_HEIGHT}}; font-size: {{DATE_FONT_SIZE}}; color: {{colors[color_week_in_year][SHADES[i]]}}; {%- if WEEKDAYS[i] == WEEKDAY_BORDER_LEFT -%} border-{{ 'right' if locale.RTL else 'left' }}: 3px solid {{colors[color_week_in_year][SHADES[i]]}};{%- endif -%}{%- if WEEKDAYS[i] == WEEKDAY_BORDER_RIGHT -%} border-{{ 'left' if locale.RTL else 'right' }}: 3px solid {{colors[color_week_in_year][SHADES[i]]}};{%- endif -%}">
                    </td>
                {%- endfor -%}
            </tr>
            <tr style="vertical-align: top;" id="time_{{time_id}}_half">
                <td style="line-height: {{WEEK_LINE_HEIGHT}}; font-size: {{HALF_UTA_FONT_SIZE}}; color: {{colors[color_week_in_year]['100' if uta < MIDDAY else '300']}}; border-{{ 'left' if locale.RTL else 'right' }}: 1px solid {{colors[color_week_in_year][shade_week_number]}};">
                    {{ '\N{LRI}' }}<span class="hide-in-mobile">{{UTAS[uta]}}{{SEPARATOR}}</span>{{HALF}}{{ '\N{PDI}' }}
                </td>
                {%- for i in SezimalRange(DAYS_IN_WEEK) -%}
                    <td style="line-height: {{WEEK_LINE_HEIGHT}}; font-size: {{DATE_FONT_SIZE}}; color: {{colors[color_week_in_year][SHADES[i]]}}; {%- if WEEKDAYS[i] == WEEKDAY_BORDER_LEFT -%} border-{{ 'right' if locale.RTL else 'left' }}: 3px solid {{colors[color_week_in_year][SHADES[i]]}};{%- endif -%}{%- if WEEKDAYS[i] == WEEKDAY_BORDER_RIGHT -%} border-{{ 'left' if locale.RTL else 'right' }}: 3px solid {{colors[color_week_in_year][SHADES[i]]}};{%- endif -%}">
                    </td>
                {%- endfor -%}
            </tr>
        {%- else -%}
            {%- if uta % 2 == 0 -%}
                <tr style="vertical-align: top; background-color: #111;" id="time_{{time_id}}">
                    <td style="line-height: {{WEEK_LINE_HEIGHT}}; font-weight: bold; font-size: {{DATE_FONT_SIZE}}; color: {{colors[color_week_in_year]['100' if uta < MIDDAY else '300']}}; border-{{ 'left' if locale.RTL else 'right' }}: 1px solid {{colors[color_week_in_year][shade_week_number]}};">
                        {{ '\N{LRI}' }}{{UTAS[uta]}}{{ '\N{PDI}' }}
                    </td>
                    {%- for i in SezimalRange(DAYS_IN_WEEK) -%}
                        <td style="line-height: {{WEEK_LINE_HEIGHT}}; font-size: {{DATE_FONT_SIZE}}; color: {{colors[color_week_in_year][SHADES[i]]}}; {%- if WEEKDAYS[i] == WEEKDAY_BORDER_LEFT -%} border-{{ 'right' if locale.RTL else 'left' }}: 3px solid {{colors[color_week_in_year][SHADES[i]]}};{%- endif -%}{%- if WEEKDAYS[i] == WEEKDAY_BORDER_RIGHT -%} border-{{ 'left' if locale.RTL else 'right' }}: 3px solid {{colors[color_week_in_year][SHADES[i]]}};{%- endif -%}">
                        </td>
                    {%- endfor -%}
                </tr>
            {%- else -%}
                <tr style="vertical-align: top;" id="time_{{time_id}}">
                    <td style="line-height: {{WEEK_LINE_HEIGHT}}; font-size: {{HALF_UTA_FONT_SIZE}}; color: {{colors[color_week_in_year]['100' if uta < MIDDAY else '300']}}; border-{{ 'left' if locale.RTL else 'right' }}: 1px solid {{colors[color_week_in_year][shade_week_number]}};">
                        {{ '\N{LRI}' }}{{UTAS[uta]}}{{ '\N{PDI}' }}
                    </td>
                    {%- for i in SezimalRange(DAYS_IN_WEEK) -%}
                        <td style="line-height: {{WEEK_LINE_HEIGHT}}; font-size: {{DATE_FONT_SIZE}}; color: {{colors[color_week_in_year][SHADES[i]]}}; {%- if WEEKDAYS[i] == WEEKDAY_BORDER_LEFT -%} border-{{ 'right' if locale.RTL else 'left' }}: 3px solid {{colors[color_week_in_year][SHADES[i]]}};{%- endif -%}{%- if WEEKDAYS[i] == WEEKDAY_BORDER_RIGHT -%} border-{{ 'left' if locale.RTL else 'right' }}: 3px solid {{colors[color_week_in_year][SHADES[i]]}};{%- endif -%}">
                        </td>
                    {%- endfor -%}
                </tr>
            {%- endif -%}
        {%- endif -%}
    {%- endfor -%}
</table>
