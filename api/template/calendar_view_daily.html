{% if not dark_mode %}
    {% include 'calendar_light_mode.html' %}
{% endif %}

{% set WEEKS = SezimalDictionary({0: '0', 1: '1', 2: '2', 3: '3', 4: '4', 5: '5', 10: '10', 11: '11', 12: '12', 13: '13', 14: '14', 15: '15', 20: '20', 21: '21', 22: '22', 23: '23', 24: '24', 25: '25', 30: '30', 31: '31', 32: '32', 33: '33', 34: '34', 35: '35', 40: '40', 41: '41', 42: '42', 43: '43', 44: '44', 45: '45', 50: '50', 51: '51', 52: '52', 53: '53', 54: '54', 55: '55', 100: '100', 101: '101', 102: '102', 103: '103', 104: '104', 105: '105', 110: '110', 111: '111', 112: '112', 113: '113', 114: '114', 115: '115', 120: '120', 121: '121', 122: '122', 123: '123', 124: '124', 125: '125'}) %}

{% if base == 14 %}
    {% set NUMBERS = SezimalDictionary({0: '0', 1: '1', 2: '2', 3: '3', 4: '4', 5: '5', 10: '6', 11: '7', 12: '8', 13: '9', 14: '10', 15: '11', 20: '12', 21: '13', 22: '14', 23: '15', 24: '16', 25: '17', 30: '18', 31: '19', 32: '20', 33: '21', 34: '22', 35: '23', 40: '24', 41: '25', 42: '26', 43: '27', 44: '28', 45: '29', 50: '30', 51: '31', 52: '32', 53: '33', 54: '34', 55: '35', 100: '36', 101: '37', 102: '38', 103: '39', 104: '40', 105: '41', 110: '42', 111: '43', 112: '44', 113: '45', 114: '46', 115: '47', 120: '48', 121: '49', 122: '50', 123: '51', 124: '52', 125: '53', 1404: '364', 1415: '371'}) %}

    {% set UTAS = SezimalDictionary({0: '00', 1: '01', 2: '02', 3: '03', 4: '04', 5: '05', 10: '06', 11: '07', 12: '08', 13: '09', 14: '10', 15: '11', 20: '12', 21: '13', 22: '14', 23: '15', 24: '16', 25: '17', 30: '18', 31: '19', 32: '20', 33: '21', 34: '22', 35: '23'}) %}
    {% set HOURS_24 = SezimalDictionary({0: '00', 1: '01', 2: '02', 3: '03', 4: '04', 5: '05', 10: '06', 11: '07', 12: '08', 13: '09', 14: '10', 15: '11', 20: '12', 21: '13', 22: '14', 23: '15', 24: '16', 25: '17', 30: '18', 31: '19', 32: '20', 33: '21', 34: '22', 35: '23'}) %}
    {% set HALF = '30' %}
    {% set SEPARATOR = locale.TIME_SEPARATOR %}
    {% set MIDDAY = 20 %}
    {% set SEASON_MOON_TIME_FORMAT = locale.ISO_HOUR_MINUTE_FORMAT %}

    {% if locale.HOUR_FORMAT == '12h' %}
        {% set UTAS = SezimalDictionary({0: '0', 1: '1', 2: '2', 3: '3', 4: '4', 5: '5', 10: '6', 11: '7', 12: '8', 13: '9', 14: '10', 15: '11', 20: '12', 21: '1', 22: '2', 23: '3', 24: '4', 25: '5', 30: '6', 31: '7', 32: '8', 33: '9', 34: '10', 35: '11'}) %}
    {% endif %}
{% elif base == 20 %}
    {% set NUMBERS = SezimalDictionary({0: '0', 1: '1', 2: '2', 3: '3', 4: '4', 5: '5', 10: '6', 11: '7', 12: '8', 13: '9', 14: '↊', 15: '↋', 20: '10', 21: '11', 22: '12', 23: '13', 24: '14', 25: '15', 30: '16', 31: '17', 32: '18', 33: '19', 34: '1↊', 35: '1↋', 40: '20', 41: '21', 42: '22', 43: '23', 44: '24', 45: '25', 50: '26', 51: '27', 52: '28', 53: '29', 54: '2↊', 55: '2↋', 100: '30', 101: '31', 102: '32', 103: '33', 104: '34', 105: '35', 110: '36', 111: '37', 112: '38', 113: '39', 114: '3↊', 115: '3↋', 120: '40', 121: '41', 122: '42', 123: '43', 124: '44', 125: '45', 1404: '264', 1415: '26↋'}) %}

    {% set UTAS = SezimalDictionary({0: '.0', 1: '.1', 2: '.2', 3: '.3', 4: '.4', 5: '.5', 10: '.6', 11: '.7', 12: '.8', 13: '.9', 14: '.↊', 15: '.↋'}) %}
    {% set HOURS_24 = SezimalDictionary({0: '.0', 1: '.1', 2: '.2', 3: '.3', 4: '.4', 5: '.5', 10: '.6', 11: '.7', 12: '.8', 13: '.9', 14: '.↊', 15: '.↋'}) %}
    {% set HALF = '6' %}
    {% set SEPARATOR = '' %}
    {% set MIDDAY = 10 %}
    {% set SEASON_MOON_TIME_FORMAT = '.#↋↋u#↋↋p' %}

{% else %}
    {% set NUMBERS = SezimalDictionary({0: '0', 1: '1', 2: '2', 3: '3', 4: '4', 5: '5', 10: '10', 11: '11', 12: '12', 13: '13', 14: '14', 15: '15', 20: '20', 21: '21', 22: '22', 23: '23', 24: '24', 25: '25', 30: '30', 31: '31', 32: '32', 33: '33', 34: '34', 35: '35', 40: '40', 41: '41', 42: '42', 43: '43', 44: '44', 45: '45', 50: '50', 51: '51', 52: '52', 53: '53', 54: '54', 55: '55', 100: '100', 101: '101', 102: '102', 103: '103', 104: '104', 105: '105', 110: '110', 111: '111', 112: '112', 113: '113', 114: '114', 115: '115', 120: '120', 121: '121', 122: '122', 123: '123', 124: '124', 125: '125', 1404: '1404', 1415: '1415'}) %}

    {% set UTAS = SezimalDictionary({0: '00', 1: '01', 2: '02', 3: '03', 4: '04', 5: '05', 10: '10', 11: '11', 12: '12', 13: '13', 14: '14', 15: '15', 20: '20', 21: '21', 22: '22', 23: '23', 24: '24', 25: '25', 30: '30', 31: '31', 32: '32', 33: '33', 34: '34', 35: '35', 40: '40', 41: '41', 42: '42', 43: '43', 44: '44', 45: '45', 50: '50', 51: '51', 52: '52', 53: '53', 54: '54', 55: '55'}) %}
    {% set HOURS_24 = SezimalDictionary({0: '00', 1: '01', 2: '02', 3: '03', 4: '04', 5: '05', 10: '10', 11: '11', 12: '12', 13: '13', 14: '14', 15: '15', 20: '20', 21: '21', 22: '22', 23: '23', 24: '24', 25: '25', 30: '30', 31: '31', 32: '32', 33: '33', 34: '34', 35: '35', 40: '40', 41: '41', 42: '42', 43: '43', 44: '44', 45: '45', 50: '50', 51: '51', 52: '52', 53: '53', 54: '54', 55: '55'}) %}
    {% set HALF = '30' %}
    {% set SEPARATOR = locale.TIME_SEPARATOR %}
    {% set MIDDAY = 30 %}
    {% set SEASON_MOON_TIME_FORMAT = '#u:#p' %}

    {% if sezimal_digits or format_token == '!' %}
        {% set NUMBERS = SezimalDictionary({0: '󱸀', 1: '󱸁', 2: '󱸂', 3: '󱸃', 4: '󱸄', 5: '󱸅', 10: '󱸁󱸀', 11: '󱸁󱸁', 12: '󱸁󱸂', 13: '󱸁󱸃', 14: '󱸁󱸄', 15: '󱸁󱸅', 20: '󱸂󱸀', 21: '󱸂󱸁', 22: '󱸂󱸂', 23: '󱸂󱸃', 24: '󱸂󱸄', 25: '󱸂󱸅', 30: '󱸃󱸀', 31: '󱸃󱸁', 32: '󱸃󱸂', 33: '󱸃󱸃', 34: '󱸃󱸄', 35: '󱸃󱸅', 40: '󱸄󱸀', 41: '󱸄󱸁', 42: '󱸄󱸂', 43: '󱸄󱸃', 44: '󱸄󱸄', 45: '󱸄󱸅', 50: '󱸅󱸀', 51: '󱸅󱸁', 52: '󱸅󱸂', 53: '󱸅󱸃', 54: '󱸅󱸄', 55: '󱸅󱸅', 100: '󱸁󱸀󱸀', 101: '󱸁󱸀󱸁', 102: '󱸁󱸀󱸂', 103: '󱸁󱸀󱸃', 104: '󱸁󱸀󱸄', 105: '󱸁󱸀󱸅', 110: '󱸁󱸁󱸀', 111: '󱸁󱸁󱸁', 112: '󱸁󱸁󱸂', 113: '󱸁󱸁󱸃', 114: '󱸁󱸁󱸄', 115: '󱸁󱸁󱸅', 120: '󱸁󱸂󱸀', 121: '󱸁󱸂󱸁', 122: '󱸁󱸂󱸂', 123: '󱸁󱸂󱸃', 124: '󱸁󱸂󱸄', 125: '󱸁󱸂󱸅', 1404: '󱸁󱸄󱸀󱸄', 1415: '󱸁󱸄󱸁󱸅'}) %}

        {% set UTAS = SezimalDictionary({0: '󱸀󱸀', 1: '󱸀󱸁', 2: '󱸀󱸂', 3: '󱸀󱸃', 4: '󱸀󱸄', 5: '󱸀󱸅', 10: '󱸁󱸀', 11: '󱸁󱸁', 12: '󱸁󱸂', 13: '󱸁󱸃', 14: '󱸁󱸄', 15: '󱸁󱸅', 20: '󱸂󱸀', 21: '󱸂󱸁', 22: '󱸂󱸂', 23: '󱸂󱸃', 24: '󱸂󱸄', 25: '󱸂󱸅', 30: '󱸃󱸀', 31: '󱸃󱸁', 32: '󱸃󱸂', 33: '󱸃󱸃', 34: '󱸃󱸄', 35: '󱸃󱸅', 40: '󱸄󱸀', 41: '󱸄󱸁', 42: '󱸄󱸂', 43: '󱸄󱸃', 44: '󱸄󱸄', 45: '󱸄󱸅', 50: '󱸅󱸀', 51: '󱸅󱸁', 52: '󱸅󱸂', 53: '󱸅󱸃', 54: '󱸅󱸄', 55: '󱸅󱸅'}) %}
        {% set HALF = '󱸃󱸀' %}
        {% set SEPARATOR = locale.TIME_SEPARATOR %}
        {% set SEASON_MOON_TIME_FORMAT = '#!u:#!p' %}
    {% endif %}
{% endif %}

{% set MONTH_LINE_HEIGHT = '2.25rem' %}
{% set WEEK_LINE_HEIGHT = '2.25rem' %}
{% set MONTH_FONT_SIZE = '1.25rem' %}
{% set WEEK_FONT_SIZE = '0.80rem' %}
{% set EMOJI_FONT_SIZE = '1.5rem' %}
{% set DATE_FONT_SIZE = '1.30rem' %}
{% set TODAY_FONT_SIZE = '1.60rem' %}
{% set EVENTS_FONT_SIZE = '1rem' %}
{% set EVENTS_LINE_HEIGHT = '2rem' %}

{% if locale.DIGITS and format_token != '!' %}
    {% for i in NUMBERS %}
        {% set NUMBERS = NUMBERS.update({i: locale.digit_replace(NUMBERS[i])}) %}
    {% endfor %}
    {% for i in UTAS %}
        {% set UTAS = UTAS.update({i: locale.digit_replace(UTAS[i])}) %}
    {% endfor %}
    {% set HALF = locale.digit_replace(HALF) %}
{% endif %}

<div id="calendar_header" class="calendar-header-fixed">
{% include 'calendar_view_change_view.html' %}
<table class="center" style="border-spacing: 0px;">
    <colgroup>
        <col span="1" width="5%">
        <col span="1">
        <col span="1" width="5%">
    </colgroup>
    <tr>
        <td colspan="3" style="font-size: 0.5rem; line-height: 0.5rem;"> </td>
    </tr>
    <tr style="vertical-align: middle;">
        <td style="font-size: 1.25rem; line-height: 2.25rem; font-weight: bold; background-color: white; color: black;" onclick="update_calendar('previous', 'day')">‹</td>
        {% if base == 10 %}
            {% if format_token == '!' %}
                <td style="font-size: 1.25rem; line-height: 2.25rem; font-weight: bold; background-color: white; color: black;">{{date.format(locale.SEZIMAL_DATE_LONG_FORMAT.replace('Y', 'X'), locale)}}</td>
            {% else %}
                <td style="font-size: 1.25rem; line-height: 2.25rem; font-weight: bold; background-color: white; color: black;">{{date.format(locale.DATE_LONG_FORMAT, locale)}}</td>
            {% endif %}
        {% elif base == 14 %}
            <td style="font-size: 1.25rem; line-height: 2.25rem; font-weight: bold; background-color: white; color: black;">{{date.format(locale.DECIMAL_DATE_LONG_FORMAT, locale)}}</td>
        {% elif base == 20 %}
            <td style="font-size: 1.25rem; line-height: 2.25rem; font-weight: bold; background-color: white; color: black;">{{date.format(locale.DOZENAL_DATE_LONG_FORMAT, locale)}}</td>
        {% endif %}
        <td style="font-size: 1.25rem; line-height: 2.25rem; font-weight: bold; background-color: white; color: black;" onclick="update_calendar('next', 'day')">›</td>
    </tr>
    <tr>
        <td colspan="3" style="font-size: 0.5rem; line-height: 0.5rem;"> </td>
    </tr>
</table>
<table class="center" style="border-spacing: 0px;">
    <colgroup>
        <col span="1">
        <col span="1">
        <col span="1">
        <col span="1">
        <col span="1">
        <col span="1">
        <col span="1">
        <col span="1">
    </colgroup>
    <tr style="vertical-align: middle; background-color: {{colors[date.week_in_year][shade_month]}}; color: {{'black' if gray_scale else 'white'}}; font-weight: bold;">
        <td colspan="2" style="line-height: {{MONTH_LINE_HEIGHT}};">
            <div id="" style="z-index: 1; width: 100%; float: {{ 'right' if locale.RTL else 'left' }}; border-{{ 'left' if locale.RTL else 'right' }}: 2px solid {{colors[date.week_in_year][back_shade_04]}};">
                {{locale.WEEK_NUMBER_SYMBOL}} {{ date.format('#' + format_token + '-wQ/#' + format_token + 'twQ', locale) }} ― {{locale.DAY_NUMBER_SYMBOL}} {{ date.format('#' + format_token + '-dQ/#' + format_token + 'tdQ', locale) }}
            </div>
            <div id="quarter_proportion" style="height: {{MONTH_LINE_HEIGHT}}; background-color: {{colors[date.week_in_year][back_shade_04]}}; width: {{ date.quarter_proportion_ellapsed.decimal * 100 }}%; z-index: -1;"></div>
        </td>
        <td colspan="4" style="line-height: {{MONTH_LINE_HEIGHT}}; font-size: {{MONTH_FONT_SIZE}};">{{date.format('#W', locale)}}</td>
        <td colspan="2" style="line-height: {{MONTH_LINE_HEIGHT}};">
            <div id="" style="z-index: 1; width: 100%; float: {{ 'left' if locale.RTL else 'right' }}; border-{{ 'right' if locale.RTL else 'left' }}: 2px solid {{colors[date.week_in_year][back_shade_04]}};">
                {{locale.WEEK_NUMBER_SYMBOL}} {{ date.format('#' + format_token + '-wY/#' + format_token + 'twY', locale) }} ― {{locale.DAY_NUMBER_SYMBOL}} {{ date.format('#' + format_token + '-dY/#' + format_token + 'tdY', locale) }}
            </div>
            <div id="year_proportion" style="height: {{MONTH_LINE_HEIGHT}}; background-color: {{colors[date.week_in_year][back_shade_04]}}; width: {{ date.year_proportion_ellapsed.decimal * 100 }}%; z-index: -1;"></div>
        </td>

        {#
        {% if base == 10 %}
            {% if format_token == '!' %}
                <td colspan="2" style="line-height: {{MONTH_LINE_HEIGHT}}; background-color: {{colors[date.week_in_year][shade_month]}}; color: {{'black' if gray_scale else 'white'}}; font-weight: bold;">{{date.format(locale.SEZIMAL_YEAR_TEXT_MONTH_FORMAT.replace('Y', 'X'), locale)}}</td>
            {% else %}
                <td colspan="2" style="line-height: {{MONTH_LINE_HEIGHT}}; background-color: {{colors[date.week_in_year][shade_month]}}; color: {{'black' if gray_scale else 'white'}}; font-weight: bold;">{{date.format(locale.YEAR_TEXT_MONTH_FORMAT, locale)}}</td>
            {% endif %}
        {% elif base == 14 %}
            <td colspan="2" style="line-height: {{MONTH_LINE_HEIGHT}}; background-color: {{colors[date.week_in_year][shade_month]}}; color: {{'black' if gray_scale else 'white'}}; font-weight: bold;">{{date.format(locale.DECIMAL_YEAR_TEXT_MONTH_FORMAT, locale)}}</td>
        {% elif base == 20 %}
            <td colspan="2" style="line-height: {{MONTH_LINE_HEIGHT}}; background-color: {{colors[date.week_in_year][shade_month]}}; color: {{'black' if gray_scale else 'white'}}; font-weight: bold;">{{date.format(locale.DOZENAL_YEAR_TEXT_MONTH_FORMAT, locale)}}</td>
        {% endif %}
        #}
    </tr>
    <tr style="vertical-align: middle; color: {{colors[date.week_in_year][shade_01]}}; font-size: {{EVENTS_FONT_SIZE}}; line-height: {{EVENTS_LINE_HEIGHT}};">
        <td colspan="5" style="text-align: {{ 'right' if locale.RTL else 'left' }};">
            {% if date.month in events %}
                {% if date.day in events[date.month] %}
                    {% for event in events[date.month][date.day] %}
                        &nbsp;<span class="emoji">{{ event.emoji }}</span> - {{ event.name }};&nbsp;
                    {% endfor %}
                {% endif %}
            {% endif %}

            {% if date.format('#TS', tz_locale) %}
                &nbsp;<span class="emoji">{{date.format('#@' + tz_locale.DEFAULT_HEMISPHERE + 'S', locale) }}</span>{{ date.format(' - #' + tz_locale.DEFAULT_HEMISPHERE + 'S (#TS)', tz_locale, season_moon_time_format=SEASON_MOON_TIME_FORMAT)}}</span>
                {% if date.format('#TL', tz_locale) %}
                <br />
                {% endif %}
            {% endif %}
            {% if date.format('#TL', tz_locale) %}
                &nbsp;<span class="emoji">{{date.format('#@' + tz_locale.DEFAULT_HEMISPHERE + 'L', locale) }}</span>{{ date.format(' - #' + tz_locale.DEFAULT_HEMISPHERE + 'L (#TL)', tz_locale, season_moon_time_format=SEASON_MOON_TIME_FORMAT)}}</span>
            {% endif %}
        </td>
        <td colspan="3" style="text-align: {{ 'left' if locale.RTL else 'right' }};">ISO: {{date.format(locale.ISO_DATE_LONG_FORMAT, locale)}} </td>
    </tr>
</table>
</div>
<table class="center" style="border-spacing: 0px;" id="time_table">
    <colgroup>
        <col span="1">
        <col span="1">
        <col span="1">
        <col span="1">
        <col span="1">
        <col span="1">
        <col span="1">
        <col span="1">
    </colgroup>
    {% for uta in SezimalList(UTAS.keys())[uta_first:uta_last] %}
        {% set time_id = HOURS_24[uta] %}
        <tr style="vertical-align: top; background-color: #111;" id="time_{{time_id}}">
            <td style="line-height: {{WEEK_LINE_HEIGHT}}; font-weight: bold; font-size: {{DATE_FONT_SIZE}}; color: {{colors[date.week_in_year]['100' if uta < MIDDAY else '300']}}; border-{{ 'left' if locale.RTL else 'right' }}: 1px solid {{colors[date.week_in_year][shade_week_number]}};">
                {{UTAS[uta]}}{% if base == 14 and locale.HOUR_FORMAT == '12h' %}<span style="font-size: {{WEEK_FONT_SIZE}};">{{ (' ' + locale.lower(locale.AM)) if uta < 20 else (' ' + locale.lower(locale.PM)) }}</span>{% endif %}
            </td>
            <td colspan="7" style="line-height: {{WEEK_LINE_HEIGHT}}; font-weight: bold; font-size: {{DATE_FONT_SIZE}}; color: {{colors[date.week_in_year][shade_01]}};"></td>
        </tr>
        <tr style="vertical-align: top;" id="time_{{time_id}}_half">
            <td style="line-height: {{WEEK_LINE_HEIGHT}}; font-size: {{HALF_UTA_FONT_SIZE}}; color: {{colors[date.week_in_year]['100' if uta < MIDDAY else '300']}}; border-{{ 'left' if locale.RTL else 'right' }}: 1px solid {{colors[date.week_in_year][shade_week_number]}};">
                {{UTAS[uta]}}{{SEPARATOR}}{{HALF}}{% if base == 14 and locale.HOUR_FORMAT == '12h' %}<span style="font-size: {{WEEK_FONT_SIZE}};">{{ ' am' if uta < 20 else ' pm' }}</span>{% endif %}
            </td>
            <td colspan="7" style="line-height: {{WEEK_LINE_HEIGHT}}; font-size: {{DATE_FONT_SIZE}}; color: {{colors[date.week_in_year][shade_01]}};"></td>
        </tr>
    {% endfor %}
</table>
<div class="calendar-time-pointer" id="time_pointer"></div>

<script type="text/javascript" id="view_script">
function auto_refresh(){
    const time_pointer_half_height = parseFloat(getComputedStyle(document.getElementById('time_pointer')).fontSize) * 1.2 / 2;
    const header_height = document.getElementById('calendar_header').getBoundingClientRect().height;

    document.getElementById('time_table').setAttribute(
        'style',
        'border-spacing: 0px; padding-top: ' + header_height + 'px;'
    );

    var seconds = new Date().getTime();
    var position = 0;
    var time_display = '';
    var time_line_id;
    var time_line_rect;

    seconds = (seconds + ({{date.time._time_zone_offset.decimal}}  * 50000 / 27)) / 1000 / 86400;
    seconds = seconds - Math.floor(seconds);

    var sec = Math.floor(seconds * 60 * 60 * 24);

    var hours = Math.floor(sec / 60 / 60);
    sec = sec - (hours * 60 * 60);

    var minutes = Math.floor(sec / 60);
    sec = sec - (minutes * 60);

    minutes = minutes.toString().padStart(2, '0');
    sec = sec.toString().padStart(2, '0');
    var hours_24 = hours.toString().padStart(2, '0');

    {% if locale.HOUR_FORMAT == '12h' %}
        if (hours > 12) {
            hours = hours - 12;
            minutes = minutes + ' {{ locale.lower(locale.PM) }}';
        } else if (hours == 12) {
            minutes = minutes + ' {{ locale.lower(locale.PM) }}';
        } else {
            minutes = minutes + ' {{ locale.lower(locale.AM) }}';
        };
    {% endif %}

    hours = hours.toString().padStart(2, '0');

    {% if base == 10 %}
        {% if format_token == '!' %}
            const PAIRS = {
                '00': '󱸀󱸀', '01': '󱸀󱸁', '02': '󱸀󱸂', '03': '󱸀󱸃', '04': '󱸀󱸄', '05': '󱸀󱸅',
                '10': '󱸁󱸀', '11': '󱸁󱸁', '12': '󱸁󱸂', '13': '󱸁󱸃', '14': '󱸁󱸄', '15': '󱸁󱸅',
                '20': '󱸂󱸀', '21': '󱸂󱸁', '22': '󱸂󱸂', '23': '󱸂󱸃', '24': '󱸂󱸄', '25': '󱸂󱸅',
                '30': '󱸃󱸀', '31': '󱸃󱸁', '32': '󱸃󱸂', '33': '󱸃󱸃', '34': '󱸃󱸄', '35': '󱸃󱸅',
                '40': '󱸄󱸀', '41': '󱸄󱸁', '42': '󱸄󱸂', '43': '󱸄󱸃', '44': '󱸄󱸄', '45': '󱸄󱸅',
                '50': '󱸅󱸀', '51': '󱸅󱸁', '52': '󱸅󱸂', '53': '󱸅󱸃', '54': '󱸅󱸄', '55': '󱸅󱸅',
            };
        {% endif %}

        var agrima = seconds * 36 * 36 * 36;
        var time = Math.floor(agrima).toString(6).padStart(6, '0');
        var uta = time.slice(0, 2);
        var posha = time.slice(2, 4);
        var agrima = time.slice(4, 6);

        //
        // Seconds is adjusted to a proportion of 30 posha,
        // so the time pointer gets positioned within
        // each halt uta time line
        //
        seconds = parseInt(agrima, 6) * 86400 / 36 / 36 / 36;

        if (posha.slice(0) >= '3') {
            time_line_id = 'time_' + uta + '_half';
            seconds = seconds + ((parseInt(posha, 6) - parseInt('30', 6)) * 86400 / 36 / 36);
        } else {
            time_line_id = 'time_' + uta;
            seconds = seconds + (parseInt(posha, 6) * 86400 / 36 / 36);
        }

        seconds = seconds / (parseInt('30', 6) * 86400 / 36 / 36);

        {% if format_token == '!' %}
            time_display = PAIRS[uta] + '{{ locale.TIME_SEPARATOR }}' + PAIRS[posha];
        {% else %}
            time_display = uta + '{{ locale.TIME_SEPARATOR }}' + posha;
        {% endif %}

        time_display = time_display + ' - ' + hours + '{{ locale.TIME_SEPARATOR }}' + minutes;

        setTimeout(auto_refresh, 33333);
    {% elif base == 14 %}
        time_display = hours + '{{ locale.TIME_SEPARATOR }}' + minutes;

        //
        // Seconds is adjusted to a proportion of 30 posha,
        // so the time pointer gets positioned within
        // each halt uta time line
        //
        seconds = parseInt(sec) * 86400 / 24 / 60 / 60;

        if (minutes.slice(0) >= '3') {
            time_line_id = 'time_' + hours_24 + '_half';
            seconds = seconds + ((parseInt(minutes) - 30) * 86400 / 24 / 60);
        } else {
            time_line_id = 'time_' + hours_24;
            seconds = seconds + (parseInt(minutes) * 86400 / 24 / 60);
        }

        seconds = seconds / (30 * 86400 / 24 / 60);

        setTimeout(auto_refresh, 30000);
    {% elif base == 20 %}
        var time = seconds * 12 * 12 * 12;
        time = Math.floor(time).toString(12).padStart(3, '0');
        var minute = time.slice(1, 3);

        //
        // Seconds is adjusted to a proportion of 30 posha,
        // so the time pointer gets positioned within
        // each halt uta time line
        //
        seconds = parseInt(minute, 12) * 86400 / 12 / 12 / 12 / 12;

        time = time.replaceAll('a', '↊').replaceAll('b', '↋');

        if (time.slice(1, 2) >= '6') {
            time_line_id = 'time_.' + time.slice(0, 1) + '_half';
            seconds = seconds + ((parseInt(minute, 12) - parseInt('60', 12)) * 86400 / 12 / 12);
        } else {
            time_line_id = 'time_.' + time.slice(0, 1);
            seconds = seconds + (parseInt(minutes, 12) * 86400 / 12 / 12);
        }

        seconds = seconds / (parseInt('60', 12) * 86400 / 12 / 12);

        time_display = '{{ locale.SEZIMAL_SEPARATOR }}' + time + ' - ' + hours + '{{ locale.TIME_SEPARATOR }}' + minutes;

        setTimeout(auto_refresh, 25000);
    {% endif %}

    time_line_rect = document.getElementById(time_line_id).getBoundingClientRect();
    position = (seconds * time_line_rect.height) + time_line_rect.top + window.scrollY - time_pointer_half_height;

    {% if locale.DIGITS %}
        time_display = time_display.replace('0', '{{ locale.DIGITS[0] }}');
        time_display = time_display.replace('1', '{{ locale.DIGITS[1] }}');
        time_display = time_display.replace('2', '{{ locale.DIGITS[2] }}');
        time_display = time_display.replace('3', '{{ locale.DIGITS[3] }}');
        time_display = time_display.replace('4', '{{ locale.DIGITS[4] }}');
        time_display = time_display.replace('5', '{{ locale.DIGITS[5] }}');
        time_display = time_display.replace('6', '{{ locale.DIGITS[6] }}');
        time_display = time_display.replace('7', '{{ locale.DIGITS[7] }}');
        time_display = time_display.replace('8', '{{ locale.DIGITS[8] }}');
        time_display = time_display.replace('9', '{{ locale.DIGITS[9] }}');
    {% endif %}

    if (document.getElementById('time_pointer')) {
        document.getElementById('time_pointer').innerHTML = '<span style="margin-{{ 'right' if locale.RTL else 'left' }}: 12.5%;"> ◂ ' + time_display + ' ▸ </span>';
        document.getElementById('time_pointer').setAttribute('style', 'top: ' + position + 'px;');
    };
};
auto_refresh();
//
// When first loading the page, makes
// shure the current time is visible
//
function center_time_pointer() {
    const time_pointer_rect = document.getElementById('time_pointer').getBoundingClientRect();
    window.scrollTo(
        0,
        //
        // Page middle
        //
        (time_pointer_rect.top + window.pageYOffset) - (window.innerHeight / 2)
    );
};
center_time_pointer();
</script>
